title,"eai:acl.owner",actions,"eai:acl.app","cron_schedule","dispatch.earliest_time","dispatch.latest_time",search
"DET-1210364-win_susp_dns_config",axg3394,"send_to_sentinel",search,"52 * * * *","-60m@m",now,"index=wineventlog EventCode IN(""150"" ""770"") ""*dns*""
| stats count by _time host EventCode SourceName Message



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210364-win_susp_dns_config""
| setfields detection_description = ""DET-1210364-win_susp_dns_config""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210420-proc_creation_win_apt_apt29_thinktanks",axg3394,"send_to_sentinel",search,"12 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
CommandLine=""*-noni*"" AND CommandLine=""*-ep*"" AND CommandLine=""*bypass*"" AND CommandLine=""*$*""
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210420-proc_creation_win_apt_apt29_thinktanks""
| setfields detection_description = ""DET-1210420-proc_creation_win_apt_apt29_thinktanks""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210421-proc_creation_win_apt_babyshark",axg3394,"send_to_sentinel",search,"6 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
(CommandLine=""reg query \""HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\"""" OR
CommandLine=""powershell.exe mshta.exe http*"" OR
CommandLine=""cmd.exe /c taskkill /im cmd.exe"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210421-proc_creation_win_apt_babyshark""
| setfields detection_description = ""DET-1210421-proc_creation_win_apt_babyshark""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210422-proc_creation_win_apt_bear_activity_gtr19",axg3394,"send_to_sentinel",search,"13 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\xcopy.exe"" CommandLine=""*/S*"" CommandLine=""*/E*"" CommandLine=""*/C*"" CommandLine=""*/Q*"" CommandLine=""*/H*"" CommandLine=""*\\\\*"") OR (Image=""*\\adexplorer.exe"" CommandLine=""*-snapshot*"" CommandLine=""*\""\""*"" CommandLine=""*c:\\users\\*"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210422-proc_creation_win_apt_bear_activity_gtr19""
| setfields detection_description = ""DET-1210422-proc_creation_win_apt_bear_activity_gtr19""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210423-proc_creation_win_apt_bluemashroom",axg3394,"send_to_sentinel",search,"14 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*\\AppData\\Local\\*"" (CommandLine=""*\\regsvr32*"" OR CommandLine=""*,DllEntry*"")) NOT 
((CommandLine=""*\\AppData\\Local\\Microsoft\\TeamsMeetingAddin\\*"" AND CommandLine=""*\\Microsoft.Teams.AddinLoader.dll*"") OR 
(CommandLine=""*\\appdata\\local\\temp\\bluezone\\*"" AND CommandLine=""*\\x64\\bzwhll.dll*"") OR
(CommandLine=""*\\AppData\\Local\\WebEx\\*"" AND CommandLine=""*\\atucfobj.dll"") OR
(CommandLine=""*\\AppData\\Local\\Programs\\WinSCP\\DragExt64.dll\"""") OR
(CommandLine=""*\\AppData\\Local\\Mozilla Firefox\\*"" AND CommandLine IN(""*\\AccessibleMarshal.dll\"""" ""*\\AccessibleHandler.dll\"""")) OR
(CommandLine=""*\\AppData\\Local\\ExpanDrive\\*"" AND CommandLine IN(""*\\ExpanDriveOverlays_x64.dll"" ""*\\ExpanDriveContextMenus_x64.dll"" ""*\\ExpanDriveOverlays_x64.2.dll"")) OR
(CommandLine=""*\\AppData\\Local\\Gpg4win\\bin_64\\*"" AND CommandLine IN(""*\\gpgex.dll\"""" ""*\\gpgol.dll\"""")) OR
(CommandLine=""*\\AppData\\Local\\Temp\\cbfs5-CTERA_ND2\\i386\\cbfsMntNtf5.dll\"""") OR
(CommandLine=""*\\AppData\\Local\\GoToMeeting\\*"" AND CommandLine=""*\\G2MOutlookAddin64.dll\""""))
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210423-proc_creation_win_apt_bluemashroom""
| setfields detection_description = ""DET-1210423-proc_creation_win_apt_bluemashroom""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210425-win_apt_cloudhopper",axg3394,"send_to_sentinel",search,"57 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
(Image=""*\\cscript.exe"" CommandLine=""*.vbs*"" CommandLine=""*/shell*"")
| stats count by _time host user ParentImage Image CommandLine  



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210425-win_apt_cloudhopper""
| setfields detection_description = ""DET-1210425-win_apt_cloudhopper""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210426-proc_creation_win_apt_dragonfly",axg3394,"send_to_sentinel",search,"15 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""'*\\crackmapexec.exe""
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210426-proc_creation_win_apt_dragonfly""
| setfields detection_description = ""DET-1210426-proc_creation_win_apt_dragonfly""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210427-proc_creation_win_apt_elise",axg3394,"send_to_sentinel",search,"16 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""C:\\Windows\\SysWOW64\\cmd.exe"" AND CommandLine=""*\\Windows\\Caches\\NavShExt.dll*"") OR (CommandLine=""*\\AppData\\Roaming\\MICROS~1\\Windows\\Caches\\NavShExt.dll,Setting"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210427-proc_creation_win_apt_elise""
| setfields detection_description = ""DET-1210427-proc_creation_win_apt_elise""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210428-win_apt_emissarypanda_sep19",axg3394,"send_to_sentinel",search,"47 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" Image=""*\\svchost.exe"" ParentImage=""*\\sllauncher.exe""
| stats count by _time host user ParentImage ParentCommandLine Image CommandLine

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210428-win_apt_emissarypanda_sep19""
| setfields detection_description = ""DET-1210428-win_apt_emissarypanda_sep19""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210429-proc_creation_win_apt_empiremonkey",axg3394,"send_to_sentinel",search,"17 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
CommandLine=""*/i:%APPDATA%\\logs.txt scrobj.dll"" AND (Image=""*\\cutil.exe"" OR Description=""Microsoft(C) Registerserver"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210429-proc_creation_win_apt_empiremonkey""
| setfields detection_description = ""DET-1210429-proc_creation_win_apt_empiremonkey""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210430-proc_creation_win_apt_equationgroup_dll_u_load",axg3394,"send_to_sentinel",search,"22 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""* -export dll_u *"" OR (CommandLine=""*,dll_u"" AND Image=""*\\rundll32.exe""))
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210430-proc_creation_win_apt_equationgroup_dll_u_load""
| setfields detection_description = ""DET-1210430-proc_creation_win_apt_equationgroup_dll_u_load""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210433-proc_creation_win_apt_hurricane_panda",axg3394,"send_to_sentinel",search,"23 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
((CommandLine=""*localgroup*"" AND CommandLine=""*admin*"" AND CommandLine=""*/add*"" AND ParentImage=""*\\Win64.exe"") OR Image=""*\\Win64.exe*"")
| stats count by _time host user Image CommandLine ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210433-proc_creation_win_apt_hurricane_panda""
| setfields detection_description = ""DET-1210433-proc_creation_win_apt_hurricane_pandas""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210434-proc_creation_win_apt_judgement_panda_gtr19",axg3394,"send_to_sentinel",search,"23 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""C:\\Users\\Public\\7za.exe"" OR CommandLine=""*eprod.ldf"" OR CommandLine=""*\\ldifde.exe -f -n*"" OR CommandLine=""*\\7za.exe a 1.7z*"" OR CommandLine=""*\\aaaa\\procdump64.exe*"" OR CommandLine=""*\\aaaa\\netsess.exe*"" OR CommandLine=""*\\aaaa\\7za.exe"" OR CommandLine=""*copy .\\1.7z \\"" OR CommandLine=""*copy \\\\client\\c$\\aaaa\\*"")
| stats count by _time host user Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210434-proc_creation_win_apt_judgement_panda_gtr19""
| setfields detection_description = ""DET-1210434-proc_creation_win_apt_judgement_panda_gtr19""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Collection"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210435-proc_creation_win_apt_mustangpanda",axg3394,"send_to_sentinel",search,"20 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine IN(""*Temp\\wtask.exe /create*"", ""*%windir:~-3,1%%PUBLIC:~-9,1%*"", ""*/tn \""Security Script *"", ""*%windir:~-1,1%*"") OR
(CommandLine=""*/E:vbscript*"" AND CommandLine=""*C:\\Users\\*"" AND CommandLine=""*.txt*"" AND CommandLine=""*/F*"")) OR
Image=""*Temp\\winwsh.exe""
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210435-proc_creation_win_apt_mustangpanda""
| setfields detection_description = ""DET-1210435-proc_creation_win_apt_mustangpanda""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Unknown"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210437-proc_creation_win_apt_sofacy",axg3394,"send_to_sentinel",search,"24 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*rundll32.exe*"" AND CommandLine=""*%APPDATA%\\*"") AND (CommandLine=""*.dat\"","" OR CommandLine=""*.dll\"",#1"" OR CommandLine=""*.dll #1"" OR CommandLine=""*.dll\"" #1"")
| stats count by _time host user Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210437-proc_creation_win_apt_sofacy""
| setfields detection_description = ""DET-1210437-proc_creation_win_apt_sofacy""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210438-proc_creation_win_apt_ta17_293a_ps",axg3394,"send_to_sentinel",search,"8 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
CommandLine=""*ps.exe -accepteula*""
| stats count by _time host ParentImage Image CommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210438-proc_creation_win_apt_ta17_293a_ps""
| setfields detection_description = ""DET-1210438-proc_creation_win_apt_ta17_293a_ps""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210439-proc_creation_win_apt_tropictrooper",axg3394,"send_to_sentinel",search,"35 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
CommandLine=""*abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc*""
| stats count by _time host user Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210439-proc_creation_win_apt_tropictrooper""
| setfields detection_description = ""DET-1210439-proc_creation_win_apt_tropictrooper""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210441-proc_creation_win_apt_unidentified_nov_18",axg3394,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
CommandLine=""*cyzfc.dat,*"" AND CommandLine=""*PointFunctionCall""
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210441-proc_creation_win_apt_unidentified_nov_18""
| setfields detection_description = ""DET-1210441-proc_creation_win_apt_unidentified_nov_18""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210442-win_apt_winnti_mal_hk_jan20",axg3394,"send_to_sentinel",search,"48 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") AND EventCode=""1"" AND (
((ParentImage=""*C:\\Windows\\Temp*"" OR ParentImage=""*\\hpqhvind.exe*"") AND Image=""C:\\ProgramData\\DRM*"") OR 
(ParentImage=""C:\\ProgramData\\DRM*"" AND Image=""*\\wmplayer.exe"") OR 
(ParentImage=""*\\Test.exe"" AND Image=""*\\wmplayer.exe"") OR 
Image=""C:\\ProgramData\\DRM\\CLR\\CLR.exe"" OR 
(ParentImage=""C:\\ProgramData\\DRM\\Windows*"" AND Image=""*\\SearchFilterHost.exe""))
| stats count by _time host user ParentImage ParentCommandLine Image CommandLine


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210442-win_apt_winnti_mal_hk_jan20""
| setfields detection_description = ""DET-1210442-win_apt_winnti_mal_hk_jan20""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210443-win_apt_wocao",axg3394,"send_to_sentinel",search,"59 * * * *","-60m@m",now,"index=wineventlog source IN(""XmlWinEventLog:Security"" ""WinEventLog:Security"") EventCode=""4799""
TargetUserName=""Administr*"" AND CallerProcessName=""*\\checkadmin.exe""
| stats count by _time host TargetUserName CallerProcessName



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210443-win_apt_wocao""
| setfields detection_description = ""DET-1210443-win_apt_wocao""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Discovery"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210444-proc_creation_win_apt_zxshell",axg3394,"send_to_sentinel",search,"26 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\rundll32.exe"" AND (CommandLine=""*zxFunction*"" OR CommandLine=""*RemoteDiskXXXXX*""))
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210444-proc_creation_win_apt_zxshell""
| setfields detection_description = ""DET-1210444-proc_creation_win_apt_zxshell""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210445-proc_creation_win_attrib_hiding_files",axg3394,"send_to_sentinel",search,"36 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\attrib.exe"" AND CommandLine=""*+h*"")
NOT (ParentImage=""*\\cmd.exe"" AND CommandLine=""*+R +H +S +A*"" AND CommandLine=""*.cui"" AND ParentCommandLine=""*C:\\WINDOWS\\system32\\*"" AND ParentCommandLine=""*.bat\"""")
NOT (ParentImage=""*\\msiexec.exe"" AND CommandLine=""*\\desktop.ini\"""")
NOT CommandLine IN(""*\\Zero G Registry\"""" ""*\\InstallAnywhere\"""")
NOT (CommandLine=""*c:\\Informatica\\*"" AND CommandLine=""*\\clients\\DeveloperClient\\developer.exe"")
NOT (CommandLine=""*\\windows\\system32\\GroupPolicy\\Machine\\Scripts\\scripts.ini*"" AND ParentCommandLine=""*\\Program Files\\Citrix\\Provisioning Services\\gposetup.cmd*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210445-proc_creation_win_attrib_hiding_files""
| setfields detection_description = ""DET-1210445-proc_creation_win_attrib_hiding_files""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210447-proc_creation_win_change_default_file_association",axg3394,"send_to_sentinel",search,"40 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*cmd*"" AND CommandLine=""* /c *"" AND CommandLine=""*assoc .*"") 
NOT ParentImage IN(""*\\acslaunch_win-64.exe"" ""*\\acslaunch_win-32.exe"")
NOT CommandLine=""*assoc .rb=RubyScript""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210447-proc_creation_win_change_default_file_association""
| setfields detection_description = ""DET-1210447-proc_creation_win_change_default_file_association""
| setfields severity = ""Low"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210448-proc_creation_win_cmdkey_recon",axg3394,"send_to_sentinel",search,"39 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\cmdkey.exe"" AND CommandLine=""* /list*"")
NOT (ParentCommandLine IN(""*\\Deploy-Application.ps1'; Exit $LastExitCode }"" ""*\\install\\Deploy-Application.ps1' -DeployMode Silent; Exit $LastExitCode }"" ""*Add-AppxPackage -Path 'C:\\Program Files (x86)\\SysTrack\\LsiAgent\\Utilities\\lsiwebhook.appx'"" ""*-HostName 'Visual Studio Code Host' -HostProfileId 'Microsoft.VSCode*"" ""*\\Microsoft.Sara.exe\"""" ""*\\TeamsCacheCleanupv2.ps1*"" ""*\\olicensecleanup.vbs*""))
NOT ParentImage=""*\\labtool.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210448-proc_creation_win_cmdkey_recon""
| setfields detection_description = ""DET-1210448-proc_creation_win_cmdkey_recon""
| setfields severity = ""Medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210449-proc_creation_win_cmstp_com_object_access",axg3394,"send_to_sentinel",search,"42 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(ParentImage=""*\\DllHost.exe"" AND IntegrityLevel IN(""High"" ""System"")) 
AND ParentCommandLine IN(""*/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*"", ""*/Processid:{3E000D72-A845-4CD9-BD83-80C07C3B881F}*"", ""*/Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}*"", ""*/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}*"", ""*/Processid:{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}*"")
NOT Image=""C:\\Windows\\System32\\ClipUp.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine Hashes
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210449-proc_creation_win_cmstp_com_object_access""
| setfields detection_description = ""DET-1210449-proc_creation_win_cmstp_com_object_access""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = PrivilegeEscalation"""" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210450-proc_creation_win_control_panel_item",axg3394,"send_to_sentinel",search,"53 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*.cpl"" NOT (CommandLine=""*\\System32\\*"" OR CommandLine=""*\\SysWOW64\\*"" OR CommandLine=""*%System%*"")) OR (Image=""*\\reg.exe"" AND CommandLine=""* add*"" AND CommandLine=""*CurrentVersion\\Control Panel\\CPLs*"")
NOT (CommandLine=""*C:\\ProgramData\\bomgar-scc*"")
NOT (CommandLine=""*igfxCPL.cpl"" AND ParentCommandLine=""*.bat"")
NOT (CommandLine=""*appwiz.cpl"" AND Image=""*\\control.exe"")
NOT (CommandLine=""control.exe mmsys.cpl"" AND ParentImage=""C:\\Program Files\\DisplayLink Core Software\\DisplayLinkTrayApp.exe"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210450-proc_creation_win_control_panel_item""
| setfields detection_description = ""DET-1210450-proc_creation_win_control_panel_item""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210452-proc_creation_win_crime_fireball",axg3394,"send_to_sentinel",search,"28 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*rundll32.exe*"" AND CommandLine=""*InstallArcherSvc*"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210452-proc_creation_win_crime_fireball""
| setfields detection_description = ""DET-1210452-proc_creation_win_crime_fireball""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210453-proc_creation_win_data_compressed_with_rar",axg3394,"send_to_sentinel",search,"41 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
((Image=""*\\rar.exe"" OR Image=""*\\winrar.exe"") AND CommandLine=""* a *"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210453-proc_creation_win_data_compressed_with_rar""
| setfields detection_description = ""DET-1210453-proc_creation_win_data_compressed_with_rar""
| setfields severity = ""Low"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Collection"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210457-proc_creation_win_exploit_cve_2015_1641",axg3394,"send_to_sentinel",search,"29 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(ParentImage=""*\\WINWORD.EXE"" AND Image=""*\\MicroScMgmt.exe"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210457-proc_creation_win_exploit_cve_2015_1641""
| setfields detection_description = ""DET-1210457-proc_creation_win_exploit_cve_2015_1641""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210459-proc_creation_win_exploit_cve_2017_11882",axg3394,"send_to_sentinel",search,"34 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
ParentImage=""*\\EQNEDT32.EXE"" 
| stats count by _time host user Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210459-proc_creation_win_exploit_cve_2017_11882""
| setfields detection_description = ""DET-1210459-proc_creation_win_exploit_cve_2017_11882""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210461-proc_creation_win_exploit_cve_2019_1378",axg3394,"send_to_sentinel",search,"28 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
(ParentCommandLine IN(""*SetupComplete.cmd"", ""*PartnerSetupComplete.cmd"") ParentCommandLine=""*\\cmd.exe*"" ParentCommandLine=""*C:\\Windows\\Setup\\Scripts\\*"" ParentCommandLine=""* /c *"")
NOT Image IN(""C:\\Windows\\System32\\*"", ""C:\\Windows\\SysWOW64\\*"", ""C:\\Windows\\WinSxS\\*"", ""C:\\Windows\\Setup\\*"" ""C:\\Windows\\CCM\\TSMBootstrap.exe"")
NOT (Image=""C:\\humscript\\CIT\\XDConfigs\\Post_Installs\\*"" AND Image=""*\\Deploy-Application.exe"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210461-proc_creation_win_exploit_cve_2019_1378""
| setfields detection_description = ""DET-1210461-proc_creation_win_exploit_cve_2019_1378""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210462-proc_creation_win_exploit_cve_2019_1388",axg3394,"send_to_sentinel",search,"29 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
(ParentImage=""*\\consent.exe"" AND Image=""*\\iexplore.exe"" AND CommandLine=""*http*"" AND IntegrityLevel=""System"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210462-proc_creation_win_exploit_cve_2019_1388""
| setfields detection_description = ""DET-1210462-proc_creation_win_exploit_cve_2019_1388""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210464-proc_creation_win_hack_rubeus",axg3394,"send_to_sentinel",search,"38 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
CommandLine IN(""*asreproast *"" ""*dump /service:krbtgt *"" ""*kerberoast *"" ""*createnetonly /program:*"" ""*ptt /ticket:*"" ""*/impersonateuser:*"" ""*renew /ticket:*"" ""*asktgt /user:*"" ""*harvest /interval:*"" ""*s4u /user:*"" ""*s4u /ticket:*"" ""*hash /password:*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210464-proc_creation_win_hack_rubeus""
| setfields detection_description = ""DET-1210464-proc_creation_win_hack_rubeus""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210465-proc_creation_win_hack_secutyxploded",axg3394,"send_to_sentinel",search,"37 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Company=""*SecurityXploded*"" OR Image=""*\\PasswordDump.exe"" OR OriginalFileName=""*PasswordDump.exe"") 
| stats count by _time host user Company OriginalFileName Image CommandLine ParentImage ParentCommandLine 
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210465-proc_creation_win_hack_secutyxploded""
| setfields detection_description = ""DET-1210465-proc_creation_win_hack_secutyxploded""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210467-proc_creation_win_hwp_exploits",axg3394,"send_to_sentinel",search,"33 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
ParentImage=""*\\Hwp.exe"" AND Image=""*\\gbb.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210467-proc_creation_win_hwp_exploits""
| setfields detection_description = ""DET-1210467-proc_creation_win_hwp_exploits""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210473-proc_creation_win_lethalhta",axg3394,"send_to_sentinel",search,"18 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
ParentImage=""*\\svchost.exe"" Image=""*\\mshta.exe""
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210473-proc_creation_win_lethalhta""
| setfields detection_description = ""DET-1210473-proc_creation_win_lethalhta""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210475-win_mal_adwind",axg3394,"send_to_sentinel",search,"58 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
((CommandLine=""*\\AppData\\Roaming\\Oracle*"" CommandLine=""*\\java*"" CommandLine=""*.exe *"") OR 
(CommandLine=""*cscript.exe*"" CommandLine=""*Retrive*"" CommandLine=""*.vbs *""))
| stats count by host ParentImage CommandLine 
| sort 0 - count
| stats count by _time host user ParentImage Image CommandLine



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210475-win_mal_adwind""
| setfields detection_description = ""DET-1210475-win_mal_adwind""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210477-proc_creation_win_malware_dtrack",axg3394,"send_to_sentinel",search,"32 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
CommandLine=""* echo EEEE > *""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210477-proc_creation_win_malware_dtrack""
| setfields detection_description = ""DET-1210477-proc_creation_win_malware_dtrack""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Impact"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210486-proc_creation_win_mavinject_proc_inj",axg3394,"send_to_sentinel",search,"31 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\Mavinject.exe"" OR Image=""*\\Mavinject32.exe"") AND CommandLine=""*/INJECTRUNNING*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210486-proc_creation_win_mavinject_proc_inj""
| setfields detection_description = ""DET-1210486-proc_creation_win_mavinject_proc_inj""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210487-proc_creation_win_mmc_spawn_shell",axg3394,"send_to_sentinel",search,"30 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(ParentImage=""*\\mmc.exe"" AND (Image IN(""\\cmd.exe"" ""*\\powershell.exe"" ""*\\wscript.exe"" ""*\\cscript.exe"" ""*\\sh.exe"" ""*\\bash.exe"" ""*\\reg.exe"" ""*\\regsvr32.exe"") OR Image=""*\\BITSADMIN*""))
NOT (CommandLine=""\""C:\\WINDOWS\\system32\\regsvr32.exe\"" -u -s YamahaAE.dll"" AND ParentCommandLine=""*\\devmgmt.msc"") ```Realtek audio driver```
NOT (CommandLine=""\""C:\\WINDOWS\\system32\\regsvr32.exe\"" -u -s RtDataProc64.dll"" AND ParentCommandLine=""*\\devmgmt.msc"") ```Realtek audio driver```
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210487-proc_creation_win_mmc_spawn_shell""
| setfields detection_description = ""DET-1210487-proc_creation_win_mmc_spawn_shell""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""LateralMovement"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210488-proc_creation_win_mshta_spawn_shell",axg3394,"send_to_sentinel",search,"19 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
ParentImage=""*\\mshta.exe"" AND (Image IN(""*\\cmd.exe"" ""*\\powershell.exe"" ""*\\wscript.exe"" ""*\\cscript.exe"" ""*\\sh.exe"" ""*\\bash.exe"" ""*\\reg.exe"" ""*\\regsvr32.exe"") OR Image=""*\\BITSADMIN*"")
NOT (CommandLine=""*\\ProgramData\\HP\\HP OfficeJet*"" OR CommandLine=""*\\ProgramData\\HP\\HP LaserJet*"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210488-proc_creation_win_mshta_spawn_shell""
| setfields detection_description = ""DET-1210488-proc_creation_win_mshta_spawn_shell""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210492-proc_creation_win_netsh_port_fwd_3389",axg3394,"send_to_sentinel",search,"45 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\netsh.exe"" AND CommandLine=""*=3389*""
NOT CommandLine=""*wlan show profiles name=3389""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210492-proc_creation_win_netsh_port_fwd_3389""
| setfields detection_description = ""DET-1210492-proc_creation_win_netsh_port_fwd_3389""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210493-proc_creation_win_netsh_port_fwd",axg3394,"send_to_sentinel",search,"44 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\netsh.exe"" AND ((CommandLine=""*interface*"" AND CommandLine=""*portproxy*"" AND CommandLine=""*add*"" AND CommandLine=""*v4tov4*"") OR (CommandLine=""*connectp*"" AND CommandLine=""*listena*"" AND CommndLine=""*c=*""))
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210493-proc_creation_win_netsh_port_fwd""
| setfields detection_description = ""DET-1210493-proc_creation_win_netsh_port_fwd""
| setfields severity = ""Medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210494-proc_creation_win_network_sniffing",axg3394,"send_to_sentinel",search,"43 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
((Image=""*\\tshark.exe"" AND CommandLine=""*-i*"") OR Image=""*\\windump.exe"") 
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210494-proc_creation_win_network_sniffing""
| setfields detection_description = ""DET-1210494-proc_creation_win_network_sniffing""
| setfields severity = ""Low"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210496-proc_creation_win_office_spawn_exe_from_users_directory",axg3394,"send_to_sentinel",search,"54 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(ParentImage IN(""*\\WINWORD.EXE"" ""*\\EXCEL.EXE"" ""*\\POWERPNT.EXE"" ""*\\MSPUB.EXE"" ""*\\VISIO.EXE"") AND Image=""*C:\\Users\\*"" AND Image=""*.exe"") NOT Image=""*\\Teams.exe""
NOT Image IN(""*\\FileCoAuth.exe"" ""*\\AppData\\Local\\Slido\\Slido for Windows\\x86\\CefSharp.BrowserSubprocess.exe"" ""*\\AppData\\Local\\Slido\\Slido for Windows\\x64\\CefSharp.BrowserSubprocess.exe"" ""*\\AppData\\Roaming\\nCryptedCloud\\bin\\nCryptedBox.exe"" ""*\\AppData\\Local\\Temp\\pollev.exe"" ""*\\Poll Everywhere\\PollEv Presenter\\BrowserWindowHelper.exe"" ""*\\pollev_browsers.exe"" ""*\\PollEv Presenter\\pollev_browsers_cefsharp.exe"" ""*\\Efficient Elements for presentations\\Program\\eeShellThumbs.exe"" ""*\\PowerPoint PowerBITilesPro Desktop\\BrowserSubprocess.exe"" ""*\\AppData\\Local\\Mozilla Firefox\\firefox.exe"" ""*\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe"" ""*\\AppData\\Local\\Microsoft\\Edge\\Application\\msedge.exe"" ""*\\AppData\\Local\\Microsoft\\Teams\\Update.exe"" ""*\\AppData\\Local\\think-cell\\setup.exe"" ""*\\AppData\\Local\\Apps\\Nasdaq\\OfficeSuite\\Daemon\\Nasdaq.Office.Service.Daemon.exe"" ""*\\AppData\\Local\\Apps\\NasdaqBoardvantage\\Office\\Daemon\\NasdaqBoardvantage.Office.Service.Daemon.exe"" ""*\\AppData\\Local\\Programs\\Jive\\Jive for Office\\LoginProcess.exe"" ""*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe"" ""*\\AppData\\Local\\Kutools for Excel\\ExtendOfficeFlash.exe"" ""*\\MZTools8VBASetup.exe"")
NOT Image=""*\\SlidoSetup_v*""
NOT (Image=""*\\AppData\\Local\\Temp\\*"" AND Image ""*\\AutoUpdate.exe"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210496-proc_creation_win_office_spawn_exe_from_users_directory""
| setfields detection_description = ""DET-1210496-proc_creation_win_office_spawn_exe_from_users_directory""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210497-win_plugx_susp_exe_locations",axg3394,"send_to_sentinel",search,"49 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" AND 
((Image=""*\\CamMute.exe"" NOT Image IN(""*\\Lenovo\Communication Utility\\*"" ""*\\Lenovo\\Communications Utility\\*"")) OR 
(Image=""*\\chrome_frame_helper.exe"" NOT Image IN(""*\\Google\\Chrome\\application\\*"")) OR 
(Image=""*\\dvcemumanager.exe"" NOT Image IN(""*\\Microsoft Device Emulator\\*"")) OR 
(Image=""*\\Gadget.exe"" NOT Image IN(""*\\Windows Media Player\\*"")) OR 
(Image=""*\\hcc.exe"" NOT Image IN(""*\\HTML Help Workshop\\*"")) OR 
(Image=""*\\hkcmd.exe"" NOT Image IN(""*\\System32\\*"" ""*\\SysNative\\*"" ""*\\SysWow64\\*"")) OR 
(Image=""*\\Mc.exe"" NOT Image IN(""*\\Microsoft Visual Studio*"" ""*\\Microsoft SDK*"" ""*\\Windows Kit*"")) OR 
(Image=""*\\MsMpEng.exe"" NOT Image IN(""*\\Microsoft Security Client\\*"" ""*\\Windows Defender\\*"" ""*\\AntiMalware\\*"")) OR 
(Image=""*\\msseces.exe"" NOT Image IN(""*\\Microsoft Security Center\\*"" ""*\\Microsoft Security Client\\*"" ""*\\Microsoft Security Essentials\\*"")) OR 
(Image=""*\\OInfoP11.exe"" NOT Image IN(""*\\Common Files\\Microsoft Shared\\*"")) OR 
(Image=""*\\OleView.exe"" NOT Image IN(""*\\Microsoft Visual Studio*"" ""*\\Microsoft SDK*"" ""*\\Windows Kit*"" ""*\\Windows Resource Kit\\*"")) OR 
(Image=""*\\rc.exe"" NOT Image IN(""*\\Microsoft Visual Studio*"" ""*\\Microsoft SDK*"" ""*\\Windows Kit*"" ""*\\Windows Resource Kit\\*"" ""*\\Microsoft.NET\\*"")))
| stats count by _time host user ParentImage ParentCommandLine Image CommandLine

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210497-win_plugx_susp_exe_locations""
| setfields detection_description = ""DET-1210497-win_plugx_susp_exe_locations""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210499-proc_creation_win_powershell_amsi_bypass",axg3394,"send_to_sentinel",search,"48 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*System.Management.Automation.AmsiUtils*"" AND CommandLine=""*amsiInitFailed*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210499-proc_creation_win_powershell_amsi_bypass""
| setfields detection_description = ""DET-1210499-proc_creation_win_powershell_amsi_bypass""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210500-win_powershell_b64_shellcode",axg3394,"send_to_sentinel",search,"7 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
CommandLine=""*AAAAYInlM*"" AND CommandLine IN(""*OiCAAAAYInlM*"" ""*OiJAAAAYInlM*"")
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210500-win_powershell_b64_shellcode""
| setfields detection_description = ""DET-1210500-win_powershell_b64_shellcode""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210501-proc_creation_win_powershell_dll_execution",axg3394,"send_to_sentinel",search,"47 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\rundll32.exe"" OR Description=""Windows-Hostprocess (Rundll32)"" OR Description=""Windows-Hostprozess (Rundll32)"") 
AND CommandLine IN(""*Default.GetString*"" ""*FromBase64String*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210501-proc_creation_win_powershell_dll_execution""
| setfields detection_description = ""DET-1210501-proc_creation_win_powershell_dll_execution""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210502-proc_creation_win_powershell_download",axg3394,"send_to_sentinel",search,"32 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\powershell.exe"" CommandLine=""*new-object*"" CommandLine=""*net.webclient).*"" CommandLine=""*download*"" (CommandLine=""*string(*"" OR CommandLine=""*file(*""))
NOT (CommandLine=""*DownloadString(''https://chocolatey.org/install.ps1*"" OR CommandLine=""*DownloadString('https://chocolatey.org/install.ps1*"")
NOT CommandLine=""*DownloadFile('http://artifactory.humana.com/artifactory*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210502-proc_creation_win_powershell_download""
| setfields detection_description = ""DET-1210502-proc_creation_win_powershell_download""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210503-proc_creation_win_encoded_frombase64string",axg3394,"send_to_sentinel",search,"0 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
CommandLine=""*::FromBase64String(*"" NOT (parent_process_name=""Agent.Worker.exe"" AND (ParentImage=""*\\tfs\\*"" OR (ParentImage=""*\\Agent*"" AND ParentImage=""*\\bin.*"")))
| stats count by _time host Image CommandLine 
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210503-proc_creation_win_encoded_frombase64string""
| setfields detection_description = ""DET-1210503-proc_creation_win_encoded_frombase64string""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210507-proc_creation_win_bitsadmin_download",axg3394,"send_to_sentinel",search,"9 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
((Image=""*\\bitsadmin.exe"" AND (CommandLine=""* /create *"" OR CommandLine=""* /addfile *"") AND CommandLine=""*http*"") OR
(Image=""*\\bitsadmin.exe"" AND CommandLine=""* /transfer *"") OR
(CommandLine=""*copy bitsadmin.exe*""))
| stats count by _time host Image CommandLine ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210507-proc_creation_win_bitsadmin_download""
| setfields detection_description = ""DET-1210507-proc_creation_win_bitsadmin_download""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210512-proc_creation_win_rdp_hijack_shadowing",axg3394,"send_to_sentinel",search,"46 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine""*noconsentprompt*"" AND CommandLine=""*shadow:*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210512-proc_creation_win_rdp_hijack_shadowing""
| setfields detection_description = ""DET-1210512-proc_creation_win_rdp_hijack_shadowing""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""LateralMovement"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210514-proc_creation_win_renamed_binary",axg3394,"send_to_sentinel",search,"6 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" OriginalFileName=""Cmd.Exe""
Image=""C:\\Users\\txy5455s\\AppData\\Local\\Temp\\HPESiteScope\\cmd64-bit.exe""
| stats count by _time host user OriginalFileName Image CommandLine ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210514-proc_creation_win_renamed_binary""
| setfields detection_description = ""DET-1210514-proc_creation_win_renamed_binary""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210517-proc_creation_win_sdbinst_shim_persistence",axg3394,"send_to_sentinel",search,"52 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\sdbinst.exe"" AND CommandLine=""*.sdb*"") NOT CommandLine=""*iisexpressshim.sdb*""
NOT (CommandLine=""*C:\\WINDOWS\\Speech\\Freedom Scientific*"" OR CommandLine=""*C:\\WINDOWS\\AppPatch\\CustomSDB\\{53e95c8e-d81a-4f80-877a-e783c727010c}.sdb*"" OR CommandLine=""*C:\\WINDOWS\\AppPatch\\CustomSDB\\{e28567ed-9263-45fb-9ab4-56d783e213bd}.sdb*"") ```Assistive technology software```
| stats count by _time host user CommandLine ParentCommandLine



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210517-proc_creation_win_sdbinst_shim_persistence""
| setfields detection_description = ""DET-1210517-proc_creation_win_sdbinst_shim_persistence""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210522-proc_creation_win_susp_bcdedit",axg3394,"send_to_sentinel",search,"49 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\bcdedit.exe"" AND CommandLine IN(""*delete*"" ""*deletevalue*"" ""*import*"" ""*safeboot*"" ""*network*"")
NOT ParentCommandLine=""/C \""C:\\Program Files\\WinMagic\\SecureDoc-NT\\UserData\\RemoveWinRE.cmd\""""
NOT ParentImage=""*\\bomgar-scc.exe""
| stats count by _time host user CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210522-proc_creation_win_susp_bcdedit""
| setfields detection_description = ""DET-1210522-proc_creation_win_susp_bcdedit""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210523-win_susp_bginfo",axg3394,"send_to_sentinel",search,"50 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\bginfo.exe"" AND CommandLine=""*/popup*"" AND CommandLine=""*/nolicprompt*"")
| stats count by _time host user ParentImage ParentCommandLine Image CommandLine

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210523-win_susp_bginfo""
| setfields detection_description = ""DET-1210523-win_susp_bginfo""
| setfields severity = ""Medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210524-proc_creation_win_susp_calc",axg3394,"send_to_sentinel",search,"50 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*\\calc.exe *"" OR (Image=""*\\calc.exe"" NOT Image=""*\\Windows\\Sys*"" NOT Image=""*\\Windows\\WinSxS\\wow64_microsoft-windows-calc_31bf3856ad364e35_10.0.19041.1_none_6a03b910ee7a4073\\*""))
| stats count by _time host user Image CommandLine ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210524-proc_creation_win_susp_calc""
| setfields detection_description = ""DET-1210524-proc_creation_win_susp_calc""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210525-proc_creation_win_susp_cdb",axg3394,"send_to_sentinel",search,"51 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\cdb.exe"" AND CommandLine=""*-cf*"")
| stats count by _time host user Image CommandLine ParentCommandLine
| sort 0 + _time


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210525-proc_creation_win_susp_cdb""
| setfields detection_description = ""DET-1210525-proc_creation_win_susp_cdb""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210528-proc_creation_win_susp_certutil_encode",axg3394,"send_to_sentinel",search,"10 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
Image=""*\\certutil.exe"" AND CommandLine=""*-f*"" AND CommandLine=""*-encode*""
| stats count by _time host ParentImage Image CommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210528-proc_creation_win_susp_certutil_encode""
| setfields detection_description = ""DET-1210528-proc_creation_win_susp_certutil_encode""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210530-proc_creation_win_susp_cmd_http_appdata",axg3394,"send_to_sentinel",search,"56 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\cmd.exe"" AND CommandLine=""*%AppData%*"" AND CommandLine IN(""*https://*"" ""*http://*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210530-proc_creation_win_susp_cmd_http_appdata""
| setfields detection_description = ""DET-1210530-proc_creation_win_susp_cmd_http_appdata""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210531-proc_creation_win_susp_codepage_switch",axg3394,"send_to_sentinel",search,"57 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\chcp.com"" 
| rex field=CommandLine ""(?<code>\ [0-9]{3,5})$""
| search code IN(""037"" ""500"" ""708"" ""709"" ""710"" ""720"" ""737"" ""775"" ""852"" ""855"" ""857"" ""858"" ""860"" ""861"" ""862"" ""863"" ""864"" ""865"" ""866"" ""869"" ""870"" ""874"" ""875"" ""932"" ""936"" ""949"" ""950"" ""1026"" ""1047"" ""1140"" ""1141"" ""1142"" ""1143"" ""1144"" ""1145"" ""1146"" ""1147"" ""1148"" ""1149"" ""1200"" ""1201"" ""1250"" ""1251"" ""1253"" ""1254"" ""1255"" ""1256"" ""1257"" ""1258"" ""1361"" ""10000"" ""10001"" ""10002"" ""10003"" ""10004"" ""10005"" ""10006"" ""10007"" ""10008"" ""10010"" ""10017"" ""10021"" ""10029"" ""10079"" ""10081"" ""10082"" ""12000"" ""12001"" ""20000"" ""20001"" ""20002"" ""20003"" ""20004"" ""20005"" ""20105"" ""20106"" ""20107"" ""20108"" ""20127"" ""20261"" ""20269"" ""20273"" ""20277"" ""20278"" ""20280"" ""20284"" ""20285"" ""20290"" ""20297"" ""20420"" ""20423"" ""20424"" ""20833"" ""20838"" ""20866"" ""20871"" ""20880"" ""20905"" ""20924"" ""20932"" ""20936"" ""20949"" ""21025"" ""21027"" ""21866"" ""28591"" ""28592"" ""28593"" ""28594"" ""28595"" ""28596"" ""28597"" ""28598"" ""28599"" ""28603"" ""28605"" ""29001"" ""38598"" ""50220"" ""50221"" ""50222"" ""50225"" ""50227"" ""50229"" ""50930"" ""50931"" ""50933"" ""50935"" ""50936"" ""50937"" ""50939"" ""51932"" ""51936"" ""51949"" ""51950"" ""52936"" ""54936"" ""57002"" ""57003"" ""57004"" ""57005"" ""57006"" ""57007"" ""57008"" ""57009"" ""57010"" ""57011"" ""65000"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210531-proc_creation_win_susp_codepage_switch""
| setfields detection_description = ""DET-1210531-proc_creation_win_susp_codepage_switch""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210534-proc_creation_win_susp_comsvcs_procdump",axg3394,"send_to_sentinel",search,"55 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(OriginalFileName=""RUNDLL32.EXE"" OR Image=""*\\rundll32.exe"") AND CommandLine=""*comsvcs*"" AND CommandLine=""*MiniDump*"" AND CommandLine=""*full*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210534-proc_creation_win_susp_comsvcs_procdump""
| setfields detection_description = ""DET-1210534-proc_creation_win_susp_comsvcs_procdump""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210536-proc_creation_win_susp_control_dll_load",axg3394,"send_to_sentinel",search,"58 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(ParentImage=""*\\System32\\control.exe"" AND Image=""*\\rundll32.exe"") NOT CommandLine=""*Shell32.dll*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210536-proc_creation_win_susp_control_dll_load""
| setfields detection_description = ""DET-1210536-proc_creation_win_susp_control_dll_load""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210539-win_susp_csc",axg3394,"send_to_sentinel",search,"51 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\csc.exe"" AND ParentImage IN(""*\\wscript.exe"" ""*\\cscript.exe"" ""*\\mshta.exe""))
| stats count by _time host user ParentImage ParentCommandLine Image CommandLine


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210539-win_susp_csc""
| setfields detection_description = ""DET-1210539-win_susp_csc""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210540-proc_creation_win_susp_curl_start_combo",axg3394,"send_to_sentinel",search,"2 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\curl.exe"" AND CommandLine=""* start *""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210540-proc_creation_win_susp_curl_start_combo""
| setfields detection_description = ""DET-1210540-proc_creation_win_susp_curl_start_combo""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210541-proc_creation_win_susp_dctask64_proc_inject",axg3394,"send_to_sentinel",search,"59 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\dctask64.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210541-proc_creation_win_susp_dctask64_proc_inject""
| setfields detection_description = ""DET-1210541-proc_creation_win_susp_dctask64_proc_inject""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210542-proc_creation_win_susp_devtoolslauncher",axg3394,"send_to_sentinel",search,"5 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\devtoolslauncher.exe"" AND CommandLine=""*LaunchForDeploy*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210542-proc_creation_win_susp_devtoolslauncher""
| setfields detection_description = ""DET-1210542-proc_creation_win_susp_devtoolslauncher""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210543-proc_creation_win_susp_dnx",axg3394,"send_to_sentinel",search,"4 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\dnx.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210543-proc_creation_win_susp_dnx""
| setfields detection_description = ""DET-1210543-proc_creation_win_susp_dnx""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210545-proc_creation_win_susp_dxcap",axg3394,"send_to_sentinel",search,"3 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\dxcap.exe"" AND CommandLine=""*-c*"" AND CommandLine=""*.exe*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210545-proc_creation_win_susp_dxcap""
| setfields detection_description = ""DET-1210545-proc_creation_win_susp_dxcap""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210548-proc_creation_win_susp_execution_path_webserver",axg3394,"send_to_sentinel",search,"1 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
Image IN(""*\\wwwroot\\*"", ""*\\wmpub\\*"", ""*\\htdocs\\*"")
(NOT Image IN(""*bin\\*"", ""*\\Tools\\*"", ""*\\SMSComponent\\*"", ""*\\maengine.exe"", ""*\\XConnectSearchIndexer.exe"" ""\\Sitecore.Xdb.Collection.Database.SqlShardingDeploymentTool.exe"") AND ParentImage IN(""*\\services.exe"" ""*\\powershell.exe""))
(NOT Image=""*\\bin\\roslyn\\csc.exe"" AND ParentImage IN(""*\\inetsrv\\w3wp.exe"" ""*\\ide\\microsoft.visualstudio.web.host.exe""))
(NOT Image=""*\\bin\\roslyn\\VBCSCompiler.exe"" AND ParentImage=""*\\bin\\roslyn\\csc.exe"")
| stats count by _time host ParentImage Image CommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210548-proc_creation_win_susp_execution_path_webserver""
| setfields detection_description = ""DET-1210548-proc_creation_win_susp_execution_path_webserver""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210551-proc_creation_win_susp_fsutil_usage",axg3394,"send_to_sentinel",search,"0 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\fsutil.exe"" OR OriginalFileName=""fsutil.exe"") AND (CommandLine=""*deletejournal*"" OR CommandLine=""*createjournal*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210551-proc_creation_win_susp_fsutil_usage""
| setfields detection_description = ""DET-1210551-proc_creation_win_susp_fsutil_usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210552-win_susp_gup",axg3394,"send_to_sentinel",search,"54 * * * *","-24h@h",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
(Image=""*\\GUP.exe"" NOT Image IN(""*\\Users\\*\\AppData\\Local\\Notepad++\\updater\\GUP.exe"" ""*\\Users\\*\\AppData\\Roaming\\Notepad++\\updater\\GUP.exe"" ""*\\Program Files\\Notepad++\\updater\\GUP.exe"" ""*\\Program Files (x86)\\Notepad++\\updater\\GUP.exe"")) parent_process_name!=""notepad++.exe""
| stats count by _time host user ParentImage Image CommandLine



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210552-win_susp_gup""
| setfields detection_description = ""DET-1210552-win_susp_gup""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210553-proc_creation_win_susp_iss_module_install",axg3394,"send_to_sentinel",search,"3 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
Image=""*\\appcmd.exe"" AND (CommandLine=""*install*"" AND CommandLine=""*module*"" AND CommandLine=""*/name:*"")
NOT (CommandLine=""*\\Program Files\\Contrast\\dotnet\\ContrastNativeHttpModule-32.dll*"" OR CommandLine=""*\\Program Files\\Contrast\\dotnet\\ContrastNativeHttpModule-64.dll*"")
NOT (CommandLine=""*/name:AspNetCoreModule*"" AND (CommandLine=""*\\aspnetcorev2.dll*"" OR CommandLine=""*\\aspnetcore.dll*""))
NOT (CommandLine=""*/name:SCCMContentAuthModule*"" AND CommandLine=""*\\ContentAuthModule.dll*"")
NOT (CommandLine=""*/name:SCCMDeviceCertAuthModule*"" AND CommandLine=""*\\DeviceCertAuthModule.dll*"")
| stats count by _time host ParentImage Image CommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210553-proc_creation_win_susp_iss_module_install""
| setfields detection_description = ""DET-1210553-proc_creation_win_susp_iss_module_install""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210560-proc_creation_win_susp_openwith",axg3394,"send_to_sentinel",search,"10 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\OpenWith.exe"" AND CommandLine=""*/c*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210560-proc_creation_win_susp_openwith""
| setfields detection_description = ""DET-1210560-proc_creation_win_susp_openwith""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210561-proc_creation_win_susp_outlook_temp",axg3394,"send_to_sentinel",search,"9 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\Temporary Internet Files\\Content.Outlook\\*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210561-proc_creation_win_susp_outlook_temp""
| setfields detection_description = ""DET-1210561-proc_creation_win_susp_outlook_temp""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""InitialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210562-proc_creation_win_susp_outlook",axg3394,"send_to_sentinel",search,"8 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""*EnableUnsafeClientMailRules*"" OR (ParentImage=""*\\outlook.exe"" AND CommandLine=""*\\\\\\\\*"" CommandLine=""*\\\\*"")) ``` CommandLine=""*.exe*""))```
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210562-proc_creation_win_susp_outlook""
| setfields detection_description = ""DET-1210562-proc_creation_win_susp_outlook""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210563-proc_creation_win_susp_ping_hex_ip",axg3394,"send_to_sentinel",search,"4 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
Image=""*\\ping.exe"" CommandLine=""*0x*"" NOT CommandLine IN(""*WK*"" ""*MKC*"" ""*POSMJ*"" ""*TRMJ*"")
| stats count by _time host Image CommandLine 
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210563-proc_creation_win_susp_ping_hex_ip""
| setfields detection_description = ""DET-1210563-proc_creation_win_susp_ping_hex_ip""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210564-proc_creation_win_susp_powershell_empire_launch",axg3394,"send_to_sentinel",search,"7 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""* -NoP -sta -NonI -W Hidden -Enc *"" OR CommandLine=""* -noP -sta -w 1 -enc *"" OR CommandLine=""* -NoP -NonI -W Hidden -enc *"" OR CommandLine=""* -noP -sta -w 1 -enc*"" OR
CommandLine=""* -enc  SQB*"" OR CommandLine=""* -nop -exec bypass -EncodedCommand *"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210564-proc_creation_win_susp_powershell_empire_launch""
| setfields detection_description = ""DET-1210564-proc_creation_win_susp_powershell_empire_launch""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210565-proc_creation_win_susp_powershell_empire_uac_bypass",axg3394,"send_to_sentinel",search,"6 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(CommandLine=""* -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*"" OR CommandLine=""* -NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210565-proc_creation_win_susp_powershell_empire_uac_bypass""
| setfields detection_description = ""DET-1210565-proc_creation_win_susp_powershell_empire_uac_bypass""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210569-proc_creation_win_susp_procdump",axg3394,"send_to_sentinel",search,"31 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
(CommandLine=""* -ma *"" AND CommandLine=""* -accepteula *"")
NOT ((Image=""D:\\Cyber-Ark Software\\Procdump\\procdump.exe"" OR Image=""D:\\Cyber-Ark Software\\Procdump\\procdump64.exe"") AND host=""LOUAPPWPS1869"")
NOT ParentImage=""*\\WerFault.exe""
NOT (user=""HUMAD\\TFSReleaseMgr"" AND ParentImage=""C:\\Windows\\DtlDownloads\\VisualStudioRemoteDeployer*"" AND ParentImage=""*\\VisualStudioRemoteDeployer.exe"")
NOT (ParentImage=""*\\procdump.exe"")
NOT ParentImage=""C:\\Program Files (x86)\\Microsoft Intune Management Extension\\ClientHealthEval.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 - _time"
"DET-1210573-proc_creation_win_susp_psr_capture_screenshots",axg3394,"send_to_sentinel",search,"12 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""*\\Psr.exe"" AND CommandLine=""*/start*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210573-proc_creation_win_susp_psr_capture_screenshots""
| setfields detection_description = ""DET-1210573-proc_creation_win_susp_psr_capture_screenshots""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Collection"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210574-proc_creation_win_susp_rasdial_activity",axg3394,"send_to_sentinel",search,"13 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
Image=""*\\rasdial.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210574-proc_creation_win_susp_rasdial_activity""
| setfields detection_description = ""DET-1210574-proc_creation_win_susp_rasdial_activity""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210581-proc_creation_win_susp_schtask_creation",axg3394,"send_to_sentinel",search,"22 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
Image=""*\\schtasks.exe"" AND CommandLine=""* /create *"" NOT user=""NT AUTHORITY\\SYSTEM""
NOT (user=""HUMAD\\RUBRIK_SVC"" AND CommandLine=""*Rubrik Post Restore Task*"" AND CommandLine=""*\\post-restore.ps1*"")
NOT (CommandLine=""*C:\\Program Files (x86)\\Server Readiness\\Installer\\*"" AND ParentCommandLine=""*C:\\Program Files (x86)\\Server Readiness\\Installer\\*"")
NOT (CommandLine=""*\\LANDesk\\LDClient\\LANDESKAgentBootStrap.exe*"" AND CommandLine=""*vulscan.exe /scan=3 /autofix=true*"")
NOT (CommandLine=""*HPCustParticipation HP*"" AND CommandLine=""*C:\\Program Files\\HP\\HP *"" AND CommandLine=""*\\Bin\\HPCustPartic.exe*"")
NOT ((CommandLine=""*/create /f /tn Adobe*"" OR CommandLine=""*/create /f /tn AnacondaInc*"") AND CommandLine=""*\\PSAppDeployToolkit\\SchTaskUnBlockApps.xml\"""")
NOT ((CommandLine=""*/CREATE /XML C:\\DRIVERS\\*"" OR CommandLine=""*/CREATE /XML C:\\SWTOOLS\\*"") AND CommandLine=""* /TN \""\\LenovoCleanup*"")
NOT (CommandLine=""*WinZip Update Notifier*"" AND CommandLine=""*\\Program Files\\WinZip\\WZUpdateNotifier.exe\\*"")
NOT (CommandLine=""*CopyPrintDriver*"" AND CommandLine=""*(Robocopy \\\\louappwps80\\drivers\\*"")
NOT (CommandLine=""*Lenovo Active Protection System*"" AND CommandLine=""*\\AppData\\Local\\Temp\\{46A84694-59EC-48F0-964C-7E76E9F8A2ED}\\aps.xml\"""")
NOT (CommandLine=""*C:\\ProgramData\\Lenovo\\ImController\\*"" AND (CommandLine=""*MonitorTask.xml*"" OR CommandLine=""*MaintenanceTask.xml*""))
NOT (CommandLine=""*C:\\WINDOWS\\System32\\DriverStore\\FileRepository\\smartstandbycomponent*"" AND CommandLine=""*\\Lenovo\\SmartStandby\\Uninstall Monitor*"")
NOT (CommandLine=""*TVT\\TVSUUpdateTask*"" AND CommandLine=""*C:\\Program Files (x86)\\Lenovo\\System Update\\tmpTVSUUpdateTask*"")
NOT (CommandLine=""SCHTASKS.EXE /Create /F /RU SYSTEM /SC ONSTART /TN npcapwatchdog /TR \""'C:\\Program Files\\Npcap\\CheckStatus.bat'\"" /NP"")
NOT (CommandLine=""*Microsoft\\Office\\Office*"" AND (CommandLine=""*\\officeinventoryagentlogon.xml\"""" OR CommandLine=""*\\officeinventoryagentfallback.xml\"""" OR CommandLine=""*\\HeartbeatConfig.xml\""""))
NOT (CommandLine=""*OffScrEx*"" AND ParentCommandLine=""*I:\\D907ATS\\60664\\install\\SupportFiles\\OffScrub*"")
NOT (CommandLine=""*/AutomatedRscripts/*"" AND ParentImage""*\\rsession.exe*"")
NOT ((CommandLine=""*\\PSAppDeployToolkit\\SchTaskUnBlockApps.xml\"""" OR CommandLine=""*\\PSAppDeployToolkit\\PSAppDeployToolkit-ExecuteAsUser.xml\"""") AND (ParentCommandLine=""*Deploy-Application.ps1*"" AND ParentCommandLine=""*Exit $LastExitCode }""))
NOT (ParentCommandLine=""*\\Downloads\\AmazonMusicInstaller*"" AND CommandLine=""*/create /tn \""Amazon Music Helper\"" /xml*"")
NOT (ParentImage=""*\\DEA Lookup\\License Lookup\\LicenseLookup.exe"" AND CommandLine=""*daily /tn dea_lookup*"")
NOT (CommandLine=""* /Create /TN \""VdrnetServerController\""*"" AND CommandLine=""*\\Mobius\\VDRNET\\srvctrl.exe*"")
NOT ((CommandLine=""*/TN MySQLNotifierTask*"" AND CommandLine=""*C:\\Program Files (x86)\\MySQL\\MySQL Notifier 1.1MySQLNotifier.exe*"") OR (CommandLine=""*/TN \\MySQL\\Installer\\ManifestUpdate*"" AND CommandLine=""*C:\\Program Files (x86)\\MySQL\\MySQL Installer for Windows\\MySQLInstallerConsole.exe*""))
NOT (CommandLine=""*\\Temp\\Temp_MapDrive_XMLtask.xml\"""" AND ParentImage=""*\\AutoIt Test\\Tool_Test_x64.exe"")
NOT (CommandLine=""*RtkAudUService64_BG*"" AND ParentCommandLine=""*\RtkAudUService64.exe\"""")
NOT (ParentCommandLine=""*\\Fiery User Software Installer\\setup.exe\"""" OR ParentCommandLine=""*\\FDU\\Fiery Driver Updater.exe\"""")
NOT (ParentCommandLine=""*\\Epson PowerENGAGE\\task_schedule.xml*"" AND CommandLine=""*Epson PowerENGAGE*"")
NOT (ParentImage=""C:\\Windows\\System32\\Kodak\\kascannerservice\\kascannerservice.exe"" AND CommandLine=""*kodakalarisincscanner*"")
NOT (CommandLine=""*\\idrive\\D907Web\\Scripts\\WebLogic\\Go365\\Clean WebLogic App Files.xml*"")
NOT (CommandLine=""*\\MCG\\CareWebQI\\WebApplication\\bin\\ReportScheduleDriver.cmd*"" AND ParentCommandLine=""*\\MCG\\CareWebQI\\WebApplication\\bin\\instsvc.cmd*"")
NOT (CommandLine=""*\\Lenovo\\Dock Manager\\DockManager*"")
NOT user=""HUMAD\\ti_qa03""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210581-proc_creation_win_susp_schtask_creation""
| setfields detection_description = ""DET-1210581-proc_creation_win_susp_schtask_creation""
| setfields severity = ""low"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210583-proc_creation_win_susp_squirrel_lolbin",axg3394,"send_to_sentinel",search,"19 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
Image=""*\\update.exe"" AND (CommandLine=""*--processStart*"" OR CommandLine=""*--createShortcut*"") AND CommandLine=""*.exe*""
| rex field=Image ""\\\(?<app>\w+)\\\(?<update>Update.exe)$"" 
| eval extension="".exe""
| eval executable=app."""".extension
| eval result=if(like(executable,""%"".app.""%""),""Contained"",""NotContained"")
| search result=""NotContained""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210583-proc_creation_win_susp_squirrel_lolbin""
| setfields detection_description = ""DET-1210583-proc_creation_win_susp_squirrel_lolbin""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210584-proc_creation_win_susp_svchost_no_cli",axg3394,"send_to_sentinel",search,"20 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
Image=""*\\svchost.exe"" AND CommandLine=""*\\svchost.exe"" NOT ParentImage IN(""*\\rpcnet.exe"" ""*\\rpcnetp.exe"") 
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210584-proc_creation_win_susp_svchost_no_cli""
| setfields detection_description = ""DET-1210584-proc_creation_win_susp_svchost_no_cli""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210585-proc_creation_win_susp_svchost",axg3394,"send_to_sentinel",search,"21 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
Image=""*\\svchost.exe"" NOT ParentImage IN(""*\\services.exe"" ""*\\MsMpEng.exe"" ""*\\Mrt.exe"" ""*\\rpcnet.exe"" ""*\\rpcnetp.exe"" ""*\\svchost.exe"" ""*\\ngen.exe"" ""*\\TiWorker.exe"" ""-"" "" "" ""?"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210585-proc_creation_win_susp_svchost""
| setfields detection_description = ""DET-1210585-proc_creation_win_susp_svchost""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210586-proc_creation_win_susp_sysprep_appdata",axg3394,"send_to_sentinel",search,"18 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
Image=""*\\sysprep.exe"" AND CommandLine=""*\\AppData\\*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210586-proc_creation_win_susp_sysprep_appdata""
| setfields detection_description = ""DET-1210586-proc_creation_win_susp_sysprep_appdata""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210587-proc_creation_win_susp_sysvol_access",axg3394,"send_to_sentinel",search,"17 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
CommandLine-""*\\SYSVOL\\*"" AND CommandLine""*\\policies\\*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210587-proc_creation_win_susp_sysvol_access""
| setfields detection_description = ""DET-1210587-proc_creation_win_susp_sysvol_access""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210590-proc_creation_win_susp_tscon_localsystem",axg3394,"send_to_sentinel",search,"16 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
user=""NT AUTHORITY\\SYSTEM"" AND Image=""*\\tscon.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210590-proc_creation_win_susp_tscon_localsystem""
| setfields detection_description = ""DET-1210590-proc_creation_win_susp_tscon_localsystem""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210591-proc_creation_win_susp_tscon_rdp_redirect",axg3394,"send_to_sentinel",search,"15 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
CommandLine=""*/dest:rdp-tcp:*""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210591-proc_creation_win_susp_tscon_rdp_redirect""
| setfields detection_description = ""DET-1210591-proc_creation_win_susp_tscon_rdp_redirect""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""LateralMovement"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210599-proc_creation_win_system_exe_anomaly",axg3394,"send_to_sentinel",search,"28 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
Image IN(""*\\svchost.exe"", ""*\\rundll32.exe"", ""*\\services.exe"", ""*\\powershell.exe"", ""*\\regsvr32.exe"", ""*\\spoolsv.exe"", ""*\\lsass.exe"", ""*\\smss.exe"", ""*\\csrss.exe"", ""*\\conhost.exe"", ""*\\wininit.exe"", ""*\\lsm.exe"", ""*\\winlogon.exe"", ""*\\explorer.exe"", ""*\\taskhost.exe"", ""*\\Taskmgr.exe"", ""*\\sihost.exe"", ""*\\RuntimeBroker.exe"", ""*\\smartscreen.exe"", ""*\\dllhost.exe"", ""*\\audiodg.exe"", ""*\\wlanext.exe"") 
NOT Image IN(""C:\\Windows\\System32\\*"", ""C:\\Windows\\system32\\*"", ""C:\\Windows\\SysWow64\\*"", ""C:\\Windows\\SysWOW64\\*"", ""C:\\Windows\\winsxs\\*"", ""C:\\Windows\\WinSxS\\*"", ""*\\SystemRoot\\System32\\*"", ""C:\\Windows\\explorer.exe"")
NOT (Image=""C:\\Program Files (x86)\\eClinicalWorks\\REGSVR32.EXE"" NOT hashes=""98c37bb67db7c76bdf0ff46e159f23ebfb37b777c9450f6e3416a3cb076ae51f"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210599-proc_creation_win_system_exe_anomaly""
| setfields detection_description = ""DET-1210599-proc_creation_win_system_exe_anomaly""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210600-win_task_folder_evasion",axg3394,"send_to_sentinel",search,"53 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
(CommandLine IN(""*echo *"" ""*copy *"" ""*type *"" ""*file createnew*"") AND CommandLine IN(""*C:\\Windows\\System32\\Tasks*"" ""*C:\\Windows\\SysWow64\\Tasks*""))
| stats count by _time host user ParentImage ParentCommandLine Image CommandLine


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210600-win_task_folder_evasion""
| setfields detection_description = ""DET-1210600-win_task_folder_evasion""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210601-win_termserv_proc_spawn",axg3394,"send_to_sentinel",search,"43 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" ((ParentCommandLine=""*\\svchost.exe*"" ParentCommandLine=""*termsvcs*"") NOT (Image=""*\\rdpclip.exe""))
| stats count by _time host user Image ParentImage CommandLine ParentCommandLine


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210601-win_termserv_proc_spawn""
| setfields detection_description = ""DET-1210601-win_termserv_proc_spawn""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""LateralMovement"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['t1210']""
``` END ```"
"DET-1210604-win_webshell_spawn",axg3394,"send_to_sentinel",search,"44 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" ParentImage IN(""*\\w3wp.exe"" ""*\\httpd.exe"" ""*\\nginx.exe"" ""*\\php-cgi.exe"" ""*\\tomcat.exe"" ""*\\UMWorkerProcess.exe"" ""*\\ws_TomcatService.exe"") Image IN(""*\\cmd.exe"" ""*\\sh.exe"" ""*\\bash.exe"" ""*\\powershell.exe"" ""*\\bitsadmin.exe"") (CommandLine!=""C:\\Windows\\system32\\cmd.exe /c \""\""C:\\Program Files\\RabbitMQ Server\\rabbitmq*\\sbin\\rabbitmqctl.bat\"" list_queues name head_message_timestamp messages"" AND user!=""NT AUTHORITY\\SYSTEM"") (CommandLine!=""\""cmd.exe\"" /cdspmqver"") NOT (host=LOUAPPWPS80 AND CommandLine=""cmd.exe /c \""ping -n 1 *exit\"""") (host!=LOUBLGWPS11 AND CommandLine!=""*\\Johnson Controls\\Metasys UI\\API\\Client\\js\\lib\\Phantomjs\\*highcharts-convert.js*"")
| stats count by _time host user ParentImage ParentCommandLine Image CommandLine


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210604-win_webshell_spawn""
| setfields detection_description = ""DET-1210604-win_webshell_spawn""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210605-proc_creation_win_win10_sched_task_0day",axg3394,"send_to_sentinel",search,"26 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
(Image=""*\\schtasks.exe"" AND CommandLine=""*/change*"" AND CommandLine=""*/TN*"" AND CommandLine=""*/RU*"" AND CommandLine=""*/RP*"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210605-proc_creation_win_win10_sched_task_0day""
| setfields detection_description = ""DET-1210605-proc_creation_win_win10_sched_task_0day""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210608-proc_creation_win_wmi_spwns_powershell",axg3394,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1
((Image=""*\\powershell.exe"" AND ParentImage=""*\\wmiprvse.exe"") AND CommandLine=""*powershell.exe*"")
NOT (CommandLine=""*C:\\WINDOWS\\CCM\\SystemTemp\\*"" OR CommandLine=""*C:\\WINDOWS\\CCM\\SignedScripts\\*"" OR CommandLine=""*Microsoft.CCM.UpdatesStore).RefreshServerComplianceState*"")
NOT (CommandLine=""*D:\\SMS_CCM\\SystemTemp\\*"" OR CommandLine=""*D:\\SMS_CCM\\SignedScripts\\*"")
NOT ((host=""louappwps2498"" AND CommandLine=""*D:\\_Automation\\*"") OR (host=""lousocwpw001"" AND CommandLine=""*C:\\Users\\sec2655s\\Documents\\Scripts\\CSOC_*""))
NOT (CommandLine=""*C:\\Windows\\TEMP\\CFIR_*"")
NOT (CommandLine=""*\\AvayaFileRegFix.ps1"")
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210608-proc_creation_win_wmi_spwns_powershell""
| setfields detection_description = ""DET-1210608-proc_creation_win_wmi_spwns_powershell""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210609-proc_creation_win_workflow_compiler",axg3394,"send_to_sentinel",search,"24 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
((Image=""*\\Microsoft.Workflow.Compiler.exe"" OR OriginalFileName=""Microsoft.Workflow.Compiler.exe"") AND CommandLine IN(""*.txt"" ""*.xml""))
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210609-proc_creation_win_workflow_compiler""
| setfields detection_description = ""DET-1210609-proc_creation_win_workflow_compiler""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210610-proc_creation_win_wsreset_uac_bypass",axg3394,"send_to_sentinel",search,"14 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
ParentImage=""*\\WSreset.exe"" NOT Image=""*\\conhost.exe""
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210610-proc_creation_win_wsreset_uac_bypass""
| setfields detection_description = ""DET-1210610-proc_creation_win_wsreset_uac_bypass""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210611-proc_creation_win_xsl_script_processing",axg3394,"send_to_sentinel",search,"23 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 
((Image=""*\\wmic.exe"" AND CommandLine=""*/format*"") OR Image=""*\\msxsl.exe"") NOT (CommandLine IN (""*/Format:List*"" ""*/Format:htable*"" ""*/Format:hform*"" ""*/Format:table*"" ""*/Format:mof*"" ""*/Format:value*"" ""*/Format:rawxml*"" ""*/Format:xml*"" ""*/Format:csv*"" ""*/Format:texttable*""))
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210611-proc_creation_win_xsl_script_processing""
| setfields detection_description = ""DET-1210611-proc_creation_win_xsl_script_processing""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210616-sysmon_cactustorch",axg3394,"send_to_sentinel",search,"56 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""8""
SourceImage IN(""*\\System32\\cscript.exe"", ""*\\System32\\wscript.exe"", ""*\\System32\\mshta.exe"", ""*\\winword.exe"", ""*\\excel.exe"")
AND TargetImage=""*\\SysWOW64\*""
| fillnull value=NULL StartModule 
| search StartModule IN(""-"", ""NULL"")
| stats count by _time host StartModule SourceImage TargetImage



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210616-sysmon_cactustorch""
| setfields detection_description = ""DET-1210616-sysmon_cactustorch""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210619-sysmon_dhcp_calloutdll",axg3394,"send_to_sentinel",search,"45 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode IN(""12"" ""13"" ""14"") 
TargetObject IN(""*\\Services\\DHCPServer\\Parameters\\CalloutDlls"" ""*\\Services\\DHCPServer\\Parameters\\CalloutEnabled"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210619-sysmon_dhcp_calloutdll""
| setfields detection_description = ""DET-1210619-sysmon_dhcp_calloutdll""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210620-registry_event_dns_serverlevelplugindll",axg3394,"send_to_sentinel",search,"46 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode IN(""12"" ""13"" ""14"") 
TargetObject=""*\\services\\DNS\\Parameters\\ServerLevelPluginDll""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210620-registry_event_dns_serverlevelplugindll""
| setfields detection_description = ""DET-1210620-registry_event_dns_serverlevelplugindll""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1210666-sysmon_webshell_creation_detect",axg3394,"send_to_sentinel",search,"55 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""11""
(((TargetFilename=""*\\inetpub\\wwwroot\\*"" AND TargetFilename IN(""*.asp*"", ""*.ashx*"", ""*.ph*"")) NOT TargetFilename IN(""*\\AppData\\Local\\Temp\\*"", ""*\\Windows\\Temp\\*"")) OR
((TargetFilename IN(""*\\www\\*"", ""*\\htdocs\\*"", ""*\\html\\*"") AND TargetFilename=""*.ph*"") NOT TargetFilename IN(""*\\AppData\\Local\\Temp\\*"", ""*\\Windows\\Temp\\*"")) OR
((TargetFilename=""*\\cgi-bin\\*"" AND TargetFilename=""*.pl*"") NOT TargetFilename IN(""*\\AppData\\Local\\Temp\\*"", ""*\\Windows\\Temp\\*"")) OR
(TargetFilename=""*.jsp"" (TargetFilename!=""C:\\Users\\*"" TargetFilename!=""*\\Downloads\\*"")))
NOT host IN(""WK*"" ""LOUXDW*"" ""SIMXDW*"" ""TRMJ*"")
| stats count by _time host file_name process_path TargetFilename
| sort 0 + _time

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210666-sysmon_webshell_creation_detect""
| setfields detection_description = ""DET-1210666-sysmon_webshell_creation_detect""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-1663105 Trickbot disable Windows Defender via Registry",sgb2991,"send_to_sentinel",search,"23 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") (host=""WK*"" OR host=""*XDW*"" OR host=""TR*"") host!=""WKHGB*"" Computer!=""*.hmhschamp.humad.com"" EventCode=13 registry_path=""HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware"" registry_value_name=""DWORD (0x00000001)"" Image!=""C:\\WINDOWS\\system32\\svchost.exe""



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1663105 Trickbot disable Windows Defender via Registry""
| setfields detection_description = ""DET-1663105 Trickbot disable Windows Defender via Registry""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3082539 UAC Bypass with Colorui COM object",sgb2991,"send_to_sentinel",search,"45 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=7 ImageLoaded=""*\\colorui.dll"" process_name != ""colorcpl.exe"" NOT(Image IN(""*\\windows\\*"", ""*\\program files*""))


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3082539-UAC-Bypass-with-Colorui-COM-object""
| setfields detection_description = ""DET-3082539-UAC-Bypass-with-Colorui-COM-object""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3082933 netsh firewall disable",sgb2991,"send_to_sentinel",search,"35 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""netsh.exe"" cmdline=""*firewall*"" AND (cmdline=""*off*"" OR cmdline=""*disable*"") AND cmdline!=""*\\statis*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3082933 netsh firewall disable""
| setfields detection_description = ""DET-3082933 netsh firewall disable""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3090835 Windows Defender stop",sgb2991,"send_to_sentinel",search,"40 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""sc.exe"" OR process_name=""net.exe"" OR process_name=""net1.exe"") AND (cmdline=""* stop *"" OR cmdline=""* delete *"") AND (cmdline=""* security center*"" OR cmdline=""* windefend*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3090835 Windows-Defender-stop""
| setfields detection_description = ""DET-3090835 Windows-Defender-stop""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3124131 Lockbit AD proliferation",sgb2991,"send_to_sentinel",search,"35 * * * *","-60m@m",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") EventCode=4104 Message=""*Get-ADComputer*"" AND Message=""*searchbase*"" AND Message=""*filter*"" AND Message=""*%s*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3124131 Lockbit AD proliferation""
| setfields detection_description = ""DET-3124131 Lockbit AD proliferation""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3124153 General sc stop antivirus",sgb2991,"send_to_sentinel",search,"20 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""sc.exe"" cmdline=""* stop sense*"" OR cmdline=""* stop windefend*"" OR cmdline=""* stop wscsvc*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3124153 General sc stop antivirus""
| setfields detection_description = ""DET-3124153 General sc stop antivirus""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3130381 Suspicious DSQuery trustedomain usage",sgb2991,"send_to_sentinel",search,"20 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""dsquery.exe"" cmdline=""* trustedDomain*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3130381 Suspicious DSQuery trustedomain usage""
| setfields detection_description = ""DET-3130381 Suspicious DSQuery trustedomain usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3134079 Privilege Escalation using SCM",sgb2991,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index=wineventlog EventCode=7045 Service_File_Name=""*ADMIN$*"" OR Service_File_Name=""*C$*"" OR Service_File_Name=""*IPC$*"" OR Service_File_Name=""*cmd /c*"" OR Service_File_Name=""*powershell*"" OR Service_File_Name=""*comspec*"" OR Service_File_Name=""*screenconnect*"" OR Service_File_Name=""*SystemDrive*"" OR Service_File_Name=""*teamviewer*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3134079 Privilege Escalation using SCM""
| setfields detection_description = ""DET-3134079 Privilege Escalation using SCM""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3135299 Lateral Movement using WinRM",sgb2991,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"")	EventCode=4104 Message=""*$DoIt = @*"" OR Message=""*[Byte[]]$varcode*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3135299 Lateral Movement using WinRM""
| setfields detection_description = ""DET-3135299 Lateral Movement using WinRM""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3138528 Rename tmp file to js",sgb2991,"send_to_sentinel",search,"15 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""cmd.exe"" cmdline=""*rename *"" cmdline=""*.tmp*"" cmdline=""*.js*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3138528 Rename tmp file to js""
| setfields detection_description = ""DET-3138528 Rename tmp file to js""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3140035 Wscript to CMD to Powershell",sgb2991,"send_to_sentinel",search,"10 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""cmd.exe"" parent_process_name=""wscript.exe"" cmdline=""*/c"" cmdline=""*powershell*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3140035 Wscript to CMD to Powershell""
| setfields detection_description = ""DET-3140035 Wscript to CMD to Powershell""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3140081 MSBuild in ProgramData",sgb2991,"send_to_sentinel",search,"15 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""msbuild.exe"" cmdline=""*programdata*"" cmdline!=""*nuget*""



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3140081 MSBuild in ProgramData""
| setfields detection_description = ""DET-3140081 MSBuild in ProgramData""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3162649 Suspicious Excel child mkdir copy",sgb2991,"send_to_sentinel",search,"10 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 parent_process_name=""excel.exe"" cmdline=""*mkdir *"" cmdline=""*&& copy*"" cmdline=""*certutil.exe*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3162649 Suspicious Excel child mkdir copy""
| setfields detection_description = ""DET-3162649 Suspicious Excel child mkdir copy""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3162718 Renamed certutil usage",sgb2991,"send_to_sentinel",search,"45 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*-urlcache*"" cmdline=""*split*"" cmdline=""*http*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3162718 Renamed certutil usage""
| setfields detection_description = ""DET-3162718 Renamed certutil usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3162922 Suspicious ntdsutil usage for dit copy",sgb2991,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""ntdsutil.exe"" AND (cmdline=""*fu*"" OR cmdline=""*full*"") AND (cmdline=""*temp*"" OR cmdline=""*perflogs*"" OR cmdline=""*programdata*"") AND cmdline!=""*Backup*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3162922 Suspicious ntdsutil usage for dit copy""
| setfields detection_description = ""DET-3162922 Suspicious ntdsutil usage for dit copy""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3163145 RunDLL suspicious network connection",sgb2991,"send_to_sentinel",search,"10 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""rundll32.exe"" cmdline=""*,GlobalOut*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3163145 RunDLL suspicious network connection""
| setfields detection_description = ""DET-3163145 RunDLL suspicious network connection""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3166353-proc_creation_win_apt_wocao",axg3394,"send_to_sentinel",search,"2 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""
CommandLine IN(""checkadmin.exe 127.0.0.1 -all*"", ""*netsh advfirewall firewall add rule name=powershell dir=in*"", ""*cmd /c powershell.exe -ep bypass -file c:\\s.ps1*"", ""*/tn win32times /f*"", ""*create win32times binPath=*"", ""*\\c$\\windows\\system32\\devmgr.dll*"", ""* -exec bypass -enc JgAg*"", ""*type *keepass\\KeePass.config.xml*"", ""*iie.exe iie.txt*"", ""*reg query HKEY_CURRENT_USER\\Software\\*\\PuTTY\\Sessions\\*"")
| stats count by _time host Image CommandLine ParentImage
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3166353-proc_creation_win_apt_wocao""
| setfields detection_description = ""DET-3166353-proc_creation_win_apt_wocao""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3200912 Malicious cobalt strike named pipes",sgb2991,"send_to_sentinel",search,"20 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=17 (PipeName=""*\\MSSE-*"" AND PipeName=""*-server*"") OR PipeName=""\\postex_*"" OR PipeName=""\\postex_ssh_*"" OR PipeName=""\\status_*"" OR PipeName=""\\msagent_*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3200912 Malicious cobalt strike named pipes""
| setfields detection_description = ""DET-3200912 Malicious cobalt strike named pipes""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3201260-Yealink-device-on-network",axg3394,"send_to_sentinel",search,"27 * * * *","-60m@m",now,"index=infoblox dhcp_type=DHCPOFFER dest_mac IN(""80:5E:C0:*"" ""80:5E:0C:*"" ""00:15:65:*"" ""24:9A:D8:*"")
| stats count by _time dest_ip dest_hostname dest_mac





``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3201260-Yealink-device-on-network""
| setfields detection_description = ""DET-3201260-Yealink-device-on-network""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Exfiltration"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3214568 Suspicious net usage for enumeration",sgb2991,"send_to_sentinel",search,"19 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""net.exe"" OR process_name=""net1.exe"") cmdline=""* view /all"" OR cmdline=""*view /all /domain""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3214568 Suspicious net usage for enumeration""
| setfields detection_description = ""DET-3214568 Suspicious net usage for enumeration""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3222708-TMO-DET-Health-Canary-NO-RESULTS-LAST-WEEK",axg3394,"send_to_sentinel",search,"1 * * * *","-7d@h",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1""  
((CommandLine=""\""C:\\Windows\\System32\\cmd.exe\"" /c c:\\temp\\DET-123\\DET-123.bat"" AND ParentCommandLine=""C:\\WINDOWS\\System32\\WScript.exe \""C:\\temp\\DET-123\\DET-123.vbs\"""") OR
(CommandLine=""C:\\WINDOWS\\System32\\WScript.exe \""C:\\temp\\DET-123\\DET-123.vbs\"""" AND ParentCommandLine=""C:\\WINDOWS\\system32\\svchost.exe -k netsvcs -p -s Schedule""))
| stats count by _time host CommandLine ParentCommandLine
| sort 0 - _time




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3222708-TMO-DET-Health-Canary-NO-RESULTS-LAST-WEEK""
| setfields detection_description = ""DET-3222708-TMO-DET-Health-Canary-NO-RESULTS-LAST-WEEK""
| setfields severity = ""Informational"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Unknown"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3245945_Potential_BlackCat_Reverse_SSH",dtw4156,"send_to_sentinel",search,"23 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""schtasks.exe"" cmdline=""*/run*"" AND cmdline=""*set-log*"" AND cmdline=""*cachetaskwevtutil.exe*"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3245945_Potential_BlackCat_Reverse_SSH""
| setfields detection_description = ""DET-3245945_Potential_BlackCat_Reverse_SSH""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3245945_Potential_BlackCat_Reverse_SSH",dtw4156,"send_to_sentinel",search,"23 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""schtasks.exe"" cmdline=""*/run*"" AND cmdline=""*set-log*"" AND cmdline=""*cachetaskwevtutil.exe*"")



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3245945_Potential_BlackCat_Reverse_SSH""
| setfields detection_description = ""DET-3245945_Potential_BlackCat_Reverse_SSH""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3245985_BlackCat_Possible_Go_Simple_Tunnel",dtw4156,"send_to_sentinel",search,"24 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""schtasks.exe"" cmdline=""*create*"" AND cmdline=""*/ru*"" AND cmdline=""*/sc"") AND (process_name=""schtasks.exe"" cmdline=""*rtcp*"" OR cmdline=""*socks5*"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3245985_BlackCat_Possible_Go_Simple_Tunnel""
| setfields detection_description = ""DET-3245985_BlackCat_Possible_Go_Simple_Tunnel""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3246007_BlackCat_Possible_BlackCat_Defense_Evasion",dtw4156,"send_to_sentinel",search,"2 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""wevtutil.exe"" cmdline=""*set-log*"" AND cmdline=""*operational*"" AND cmdline=""*/enabled:false*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3246007_BlackCat_Possible_BlackCat_Defense_Evasion""
| setfields detection_description = ""DET-3246007_BlackCat_Possible_BlackCat_Defense_Evasion""
| setfields severity = ""Medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3246023_Potential_BlackCat_Disabling_logging_via_WinRM",dtw4156,"send_to_sentinel",search,"21 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""wevtutil.exe"" AND cmdline=""*set-log*"" AND cmdline=""*/enabled:false*"") AND (cmdline=""*application*"" OR cmdline=""*internet explorer*"" OR cmdline=""*hardwareevents*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3246023_Potential_BlackCat_Disabling_logging_via_WinRM""
| setfields detection_description = ""DET-3246023_Potential_BlackCat_Disabling_logging_via_WinRM""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""LateralMovement"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3246036_Potential_BlackCat_lateral_movement_via_RDP",dtw4156,"send_to_sentinel",search,"22 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""reg.exe"" cmdline=""*add*"" AND cmdline=""*disablerestrictedadmin*"" AND cmdline =""*reg_dword*"" AND cmdline =""*/d 0 1*"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3246036_Potential_BlackCat_lateral_movement_via_RDP""
| setfields detection_description = ""DET-3246036_Potential_BlackCat_lateral_movement_via_RDP""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""LateralMovement"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3246051_Potential_BlackCat_Command_Seen",dtw4156,"send_to_sentinel",search,"0 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""schtasks.exe"" cmdline=""*/run*"" AND cmdline=""*set-log*"" AND cmdline=""*cachetaskwevtutil.exe*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3246051_Potential_BlackCat_Command_Seen""
| setfields detection_description = ""DET-3246051_Potential_BlackCat_Command_Seen""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3246110_Atera_agent_call_home_seen",dtw4156,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index = ""zscaler"" ""*agent-api-atera.com*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3246110_Atera_agent_call_home_seen""
| setfields detection_description = ""DET-3246110_Atera_agent_call_home_seen""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3248282-Potential Bazarloader activity from Website Contact Forms",dtw4156,"send_to_sentinel",search,"3 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""regsvr32.exe"" cmdline=""*DumpStack.log*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3248282-Potential Bazaloader activity from Website Contact Forms ""
| setfields detection_description = ""DET-3248282-Potential Bazaloader activity from Website Contact Forms ""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3249415-Potential_HermeticWiper_like_activity_detected",dtw4156,"send_to_sentinel",search,"4 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""rundll32.exe"" cmdline=""*MiniDump 600*"" cmdline=""*winupd.log full*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3249415-Potential_HermeticWiper_like_activity_detected""
| setfields detection_description = ""DET-3249415-Potential_HermeticWiper_like_activity_detected""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3251845 - Loki Ransomware Registry Key",dtw4156,"send_to_sentinel",search,"22 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") (EventCode=13 TargetObject=""*software\\loki*"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3251845 - Loki Ransomware Registry Key""
| setfields detection_description = ""DET-3251845 - Loki Ransomware Registry Key""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3251865-Loki configuration file created",dtw4156,"send_to_sentinel",search,"6 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") (EventCode=11 TargetFileName=""*config.loki*"") OR (EventCode=12 TargetObject=""*config.loki*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3251865-Loki configuration file created""
| setfields detection_description = ""DET-3251865-Loki configuration file created""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3251915-Loki_Ransomware_persistent",dtw4156,"send_to_sentinel",search,"26 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""schtasks.exe"" cmdline=""*/CREATE*"" cmdline=""*/SC*"" cmdline=""*/ONLOGON*"" cmdline=""*loki*"" cmdline=""*winlogon"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3251915-Loki_Ransomware_persistent""
| setfields detection_description = ""DET-3251915-Loki_Ransomware_persistent""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3251965-Potential Loki Ransomware C&C traffic",dtw4156,"send_to_sentinel",search,"1 * * * *","-60m@m",now,"index = ""zscaler"" url=""*loki-locker.one*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3251965-Potential Loki Ransomware C&C traffic""
| setfields detection_description = ""DET-3251965-Potential Loki Ransomware C&C traffic""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3252010-Unusual deletion of backups utilizing wbadmin.exe",dtw4156,"send_to_sentinel",search,"7 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""wbadmin.exe"" cmdline=""*delete*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3252010-Unusual deletion of backups utilizing wbadmin.exe""
| setfields detection_description = ""DET-3252010-Unusual deletion of backups utilizing wbadmin.exe""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3271053-Unusual_Clearing_of_logs_using_wevtutil",dtw4156,"send_to_sentinel",search,"8 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""wevtutil.exe"" (cmdline=""* cl *"" OR cmdline=""*clear*"") (cmdline=""*application*"" OR cmdline=""*system*"" OR cmdline=""*security*"") CurrentDirectory!=""C:\\windows\\ccm\\""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3271053-Unusual_Clearing_of_logs_using_wevtutil""
| setfields detection_description = ""DET-3271053-Unusual_Clearing_of_logs_using_wevtutil""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3271087-Lockbit_2.0_possible_persistence_created_Lockbit_Ransomware.hta",dtw4156,"send_to_sentinel",search,"28 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") (EventCode=11 TargetFileName=""*LockBit_Ransomware.hta *"") OR (EventCode=12 TargetObject=""*LockBit_Ransomware.hta*"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3271087-Lockbit_2.0_possible_persistence_created_Lockbit_Ransomware.hta""
| setfields detection_description = ""DET-3271087-Lockbit_2.0_possible_persistence_created_Lockbit_Ransomware.hta""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""Persistence""
``` END ```"
"DET-3271090-Lockbit_2.0_Icon_created",dtw4156,"send_to_sentinel",search,"27 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") (EventCode=11 TargetFileName=""*.lockbit*"") OR (EventCode=12 TargetObject=""*.lockbit*"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3271090-Lockbit_2.0_Icon_created""
| setfields detection_description = ""DET-3271090-Lockbit_2.0_Icon_created""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Persistence"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3275835-Possible PRIVATELOG or STASHLOG activity - clfsw32.dll",dtw4156,"send_to_sentinel",search,"9 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""svchost.exe"" cmdline=""*clfsw32.dll*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3275835-Possible PRIVATELOG or STASHLOG activity - clfsw32.dll""
| setfields detection_description = ""DET-3275835-Possible PRIVATELOG or STASHLOG activity - clfsw32.dll""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3275913-Possible PRIVATELOG or STASHLOG activity -SVCHOST loading ktmw32 or clfsw32",dtw4156,"send_to_sentinel",search,"10 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""svchost.exe"" cmdline=""*-k*"" cmdline=""*print*"" (cmdline=""*ktmw32.dll*"" OR cmdline=""*clfsw32.dll*"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3275913-Possible PRIVATELOG or STASHLOG activity -SVCHOST loading ktmw32 or clfsw32""
| setfields detection_description = ""DET-3275913-Possible PRIVATELOG or STASHLOG activity -SVCHOST loading ktmw32 or clfsw32""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3279025-Potential_BackDoor_Malware_SysJoker_sysjoker.exe",dtw4156,"send_to_sentinel",search,"11 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""sysjoker.exe""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3279025-Potential_BackDoor_Malware_SysJoker_sysjoker.exe""
| setfields detection_description = ""DET-3279025-Potential_BackDoor_Malware_SysJoker_sysjoker.exe""
| setfields severity = ""High"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3279128-Potential Malware SysJoker_Get_Serial_Number",dtw4156,"send_to_sentinel",search,"12 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""wmic.exe"" cmdline=""*path*"" cmdline =""*win32_physicalmedia*"" cmdline = ""*get SerialNumber""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3279128-Potential Malware SysJoker_Get_Serial_Number""
| setfields detection_description = ""DET-3279128-Potential Malware SysJoker_Get_Serial_Number""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3279171-Potential Malware SysJoker_Get_OSArchitecture",dtw4156,"send_to_sentinel",search,"13 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""wmic.exe"" cmdline=""*CSDVersion*"" cmdline =""*OSArchitecture*"" cmdline = ""*Version*"" cmdline =""*value*"", ""*SystemData*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3279171-Potential Malware SysJoker_Get_OSArchitecture""
| setfields detection_description = ""DET-3279171-Potential Malware SysJoker_Get_OSArchitecture""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3279672-Potential_Backdoor_Malware SysJoker_Get_IP_Address",dtw4156,"send_to_sentinel",search,"15 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""wmic.exe"" cmdline=""*nicconfig*"" cmdline =""*IPEnabled*"" cmdline = ""*get ipaddress*"" cmdline = ""*SystemData""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3279672-Potential_Backdoor_Malware SysJoker_Get_IP_Address""
| setfields detection_description = ""DET-3279672-Potential_Backdoor_Malware SysJoker_Get_IP_Address""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""InitialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3279742-Potential_Backdoor_Malware ""SysJoker""_reg_add_igfxCUISerivce",dtw4156,"send_to_sentinel",search,"16 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""reg.exe"" cmdline=""*ADD*"" cmdline =""*CurrentVersion\\Run*"" cmdline = ""*igfxCUIService*"" cmdline = ""*SystemData""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3279742-Potential_Backdoor_Malware ""SysJoker""_reg_add_igfxCUISerivce""
| setfields detection_description = ""DET-3279742-Potential_Backdoor_Malware ""SysJoker""_reg_add_igfxCUISerivce""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""InitialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3280543-Potential_Bazarcall_infection_Atera_installed",dtw4156,"send_to_sentinel",search,"17 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=11 (TargetFilename=""*System.ValueTuple.dll*"" OR TargetFilename=""*BouncyCastle.Crypto.dll*""  OR Targetfilename=""*ICSharpCode.SharpZipLib.dll*"" OR TargetFilename=""*pubnub.dll"" OR TargetFilename=""*Newtonsoft.Json.dll"") AND TargetFilename =""*AteraAgent*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3280543-Potential_Bazarcall_infection_Atera_installed""
| setfields detection_description = ""DET-3280543-Potential_Bazarcall_infection_Atera_installed""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""InitialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3280563-Potential_Atera_Persistence_created_from_Bazarcall",dtw4156,"send_to_sentinel",search,"18 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""sc.exe"" cmdline=""*failure*"" cmdline=""*AteraAgent*"" cmdline=""*reset*"" cmdline = ""*restart*"" cmdline =""*25000*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3280563-Potential_Atera_Persistence_created_from_Bazarcall""
| setfields detection_description = ""DET-3280563-Potential_Atera_Persistence_created_from_Bazarcall""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""InitialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3280579-Potential_AteraAgent_Installation_Integratorlogin",dtw4156,"send_to_sentinel",search,"20 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""*AteraAgent.exe*""cmdline=""*integratorlogin*"" cmdline=""*AteraAgent*"" cmdline=""*Company Id*"" cmdline = ""*IntegratorLoginUI*"" cmdline =""*CompanyIdUI*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3280579-Potential_AteraAgent_Installation_Integratorlogin""
| setfields detection_description = ""DET-3280579-Potential_AteraAgent_Installation_Integratorlogin""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""InitialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3280996-Script_execution_Decoding_Veeam_stored_credentials",dtw4156,"send_to_sentinel",search,"14 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""*powershell.exe*""cmdline=""*add-type*"" cmdline=""*Veeam*"" cmdline=""*$encoded*"" cmdline = ""*-path*"" cmdline =""*Veeam.Backup.Common.dll*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3280996-Script_execution_Decoding_Veeam_stored_credentials""
| setfields detection_description = ""DET-3280996-Script_execution_Decoding_Veeam_stored_credentials""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3286719-Possible_abuse_of_rundll32.exe_to_execute_file_or_script",dtw4156,"send_to_sentinel",search,"29 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""rundll32.exe"" cmdline=""*advpack.dll*"") AND cmdline !=""*c:\\windows\\*"" cmdline !=""*c:\\ibm\\*"" AND image !=""*\\SysWOW*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3286719-Possible_abuse_of_rundll32.exe_to_execute_file_or_script""
| setfields detection_description = ""DET-3286719-Possible_abuse_of_rundll32.exe_to_execute_file_or_script""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3289497-Possible_PLINK_tunnel_established",dtw4156,"send_to_sentinel",search,"30 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""plink.exe"") cmdline=""*-n*"" cmdline = ""*-t*"" cmdline =""*-r*"" cmdline =""*-p""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3289497-Possible_PLINK_tunnel_established""
| setfields detection_description = ""DET-3289497-Possible_PLINK_tunnel_established""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3290411-Potential_dump_of_LSASS_Memory_via_ProcDump",dtw4156,"send_to_sentinel",search,"32 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""pr64.exe"" OR process_name=""procdump.exe"" OR process_name=""procdump64.exe"") cmdline=""*accepteula*"" cmdline=""*lsass*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3290411-Potential_dump_of_LSASS_Memory_via_ProcDump""
| setfields detection_description = ""DET-3290411-Potential_dump_of_LSASS_Memory_via_ProcDump""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3290495-Potential_DRAWSTRING_Activity_Firewall_Modification",dtw4156,"send_to_sentinel",search,"32 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""netsh.exe"") cmdline=""*.advfirewall*"" cmd=""*private*"" cmd=""*Add rule*"" cmdline=""*Software Update*"" cmdline=""*profile=*"" cmdline = ""*public*"" cmdline = ""*protocol*"" cmdline=""*any*"" cmdline=""*enable*"" cmdline=""*yes*"" cmdline=""*action*"" cmdline =""*allow*"" cmdline =""*program*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3290495-Potential_DRAWSTRING_Activity_Firewall_Modification""
| setfields detection_description = ""DET-3290495-Potential_DRAWSTRING_Activity_Firewall_Modification""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3291038-Possible_DarkWatchmanRAT_activity_UA",dtw4156,"send_to_sentinel",search,"31 * * * *","-60m@m",now,"index=zscaler ua=""*rv:11.1*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3291038-Possible_DarkWatchmanRAT_activity_UA""
| setfields detection_description = ""DET-3291038-Possible_DarkWatchmanRAT_activity_UA""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3292765-Unusual_use_of_Esentutl.exe",dtw4156,"send_to_sentinel",search,"34 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""esentutl.exe"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3292765-Unusual_use_of_Esentutl.exe""
| setfields detection_description = ""DET-3292765-Unusual_use_of_Esentutl.exe""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3293111-Possible_qbot_infection_emailstorage",dtw4156,"send_to_sentinel",search,"35 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*EmailStorage_*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3293111-Possible_qbot_infection_emailstorage""
| setfields detection_description = ""DET-3293111-Possible_qbot_infection_emailstorage""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3293841-Possible_Conti_activity_powershell_Get-ADComputer",dtw4156,"send_to_sentinel",search,"36 * * * *","-60m@m",now,"Index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""powershell.exe"" (cmdline=""*Sort-Object*"" cmdline =""*Select-Object*"" cmdline = ""*Operatingsystem*"" cmdline=""*Get-ADComputer*"" cmdline=""*Out-file*"")



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3293841-Possible_Conti_activity_powershell_Get-ADComputer""
| setfields detection_description = ""DET-3293841-Possible_Conti_activity_powershell_Get-ADComputer""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3295879-Potential_QBOT_activity_ENV_TEMP",dtw4156,"send_to_sentinel",search,"37 * * * *","-24h@h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*$env:temp/*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3295879-Potential_QBOT_activity_ENV_TEMP""
| setfields detection_description = ""DET-3295879-Potential_QBOT_activity_ENV_TEMP""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3295906-Possible_Qbot_AdFind_Activity",dtw4156,"send_to_sentinel",search,"37 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*objectcategory=computer*"" cmdline =""*-csv*"" cmdline =""*dNSHostName*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3295906-Possible_Qbot_AdFind_Activity""
| setfields detection_description = ""DET-3295906-Possible_Qbot_AdFind_Activity""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3295915-Suspicious_query_for_installed_security_software",dtw4156,"send_to_sentinel",search,"38 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""wmic.exe"" (cmdline=""*AntiSpywareProduct*"" OR cmdline=""*AntiVirusProduct*"" OR cmdline=""*FirewallProduct*"") AND cmdline=""*GET*"" AND cmdline =""*/Value*"" AND cmdline = ""*SecurityCenter2*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3295915-Suspicious_query_for_installed_security_software""
| setfields detection_description = ""DET-3295915-Suspicious_query_for_installed_security_software""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3295972-Suspicious_scheduled_task_executing_encoded_payload_from_registry",dtw4156,"send_to_sentinel",search,"39 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1  ProcessName=""sc.exe"" cmdline=""*/Create*"" cmdline =""*/SC*"" cmdline =""*FromBase64String*"" cmdline=""*powershell*"" cmdline=""*Get-ItemProperty*"" cmdline=""*HKCU:*""


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3295972-Suspicious_scheduled_task_executing_encoded_payload_from_registry""
| setfields detection_description = ""DET-3295972-Suspicious_scheduled_task_executing_encoded_payload_from_registry""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3303608-Suspicious_use_of_lacheck.exe",dtw4156,"send_to_sentinel",search,"39 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""LACheck.exe""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3303608-Suspicious_use_of_lacheck.exe""
| setfields detection_description = ""DET-3303608-Suspicious_use_of_lacheck.exe""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3304553-Potential_Splashtop_RMM_tool_install_attempt",dtw4156,"send_to_sentinel",search,"41 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""srutility.exe"" OR process_name=""agentpackagestremote.exe"" OR process_name=""splashtopstreamer3360.exe"") OR (cmdline=""*com.splashtop.streamer*"" OR cmdline=""*st-streamer:*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3304553-Potential_Splashtop_RMM_tool_install_attempt""
| setfields detection_description = ""DET-3304553-Potential_Splashtop_RMM_tool_install_attempt""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3304800-Syncro_RMM_url_attempted_download_or_call_home",dtw4156,"send_to_sentinel",search,"42 * * * *","-60m@m",now,"index = zscaler ehost=""*.syncromsp.com*"" ehost !=""*security.microsoft.com*"" ehost!=""*www.syncromsp.com*"" image !=""*HUM_Guest*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3304800-Syncro_RMM_url_attempted_download_or_call_home""
| setfields detection_description = ""DET-3304800-Syncro_RMM_url_attempted_download_or_call_home""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3304809-Syncro_RMM_Install_attempt",dtw4156,"send_to_sentinel",search,"43 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""syncro.installer.exe""



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3304809-Syncro_RMM_Install_attempt""
| setfields detection_description = ""DET-3304809-Syncro_RMM_Install_attempt""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3312412-Possible_FIN7_use_of_powershell",dtw4156,"send_to_sentinel",search,"44 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""powershell.exe"") cmdline=""*-ex bypass*"" cmdline !=""*intunemanagement*"" cmdline !=""*BitLockerPINDialog*""
``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3312412-Possible_FIN7_use_of_powershell""
| setfields detection_description = ""DET-3312412-Possible_FIN7_use_of_powershell""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3324652-Potential_tunneling_tool_Ligolo-ng.md",dtw4156,"send_to_sentinel",search,"45 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""agent.exe"") cmdline=""*-connect*"" (cmdline=""*-autocert*"" OR cmdline=""*-certfile*"" OR cmdline=""*-keyfile*"" OR cmdline =""*-selfcert*"" OR cmdline=""*-ignore-cert*"" OR cmdline=""--socks*"" OR cmdline =""*--socks-user*"" OR cmdline=""*--socks-pass*"" )

 
 
``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3324652-Potential_tunneling_tool_Ligolo-ng""
| setfields detection_description = ""DET-3324652-Potential_tunneling_tool_Ligolo-ng""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""T1572""
``` END ```"
"DET-3325910 Startup folder file writes by commonly abused processes",sgb2991,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=11 TargetFilename IN (""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*"", ""C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\*"")
process_name IN (""cmd.exe"",
                  ""powershell.exe"",
                  ""wmic.exe"",
                  ""mshta.exe"",
                  ""pwsh.exe"",
                  ""cscript.exe"",
                  ""wscript.exe"",
                  ""regsvr32.exe"",
                  ""RegAsm.exe"",
                  ""rundll32.exe"",
                  ""EQNEDT32.EXE"",
                  ""WINWORD.EXE"",
                  ""EXCEL.EXE"",
                  ""POWERPNT.EXE"",
                  ""MSPUB.EXE"",
                  ""MSACCESS.EXE"",
                  ""iexplore.exe"",
                  ""InstallUtil.exe"")
TargetFilename !IN (""*\\DIG_CS_ECW_ChromeMonitor.exe - Shortcut.lnk"", ""*\\Monitor Ink Alerts*"", ""*\\Users\\LLS4144\\*"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3325910 Startup folder file writes by commonly abused processes""
| setfields detection_description = ""DET-3325910 Startup folder file writes by commonly abused processes""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3344544-Disabling_of_Windows_Eventlogs_Via_SC",dtw4156,"send_to_sentinel",search,"46 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""sc.exe"" cmdline =""*disable*"" cmdline=""*config*"" cmdline=""*eventlog*"" cmdline=""*start*""

 
``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3344544-Disabling_of_Windows_Eventlogs_Via_SC""
| setfields detection_description = ""DET-3344544-Disabling_of_Windows_Eventlogs_Via_SC""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""DefenseEvasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""T1562.002""
``` END ```"
"Det-3353196-Potential_malicious_use_of_certutil",dtw4156,"send_to_sentinel",search,"47 * * * *","-60m@m",now,"index=wineventlog
    (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"")
    EventCode=1 NOT Image IN (""*certutil.exe"", ""*certutil32.exe"")
    FileName =""*.exe""
    OriginalFileName IN (""*CertUtil.exe"", ""*Certutil32.exe"")
    NOT cmdline IN (""*//installer//*"", ""*//program files//*"")
    
    
    ``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""Det-3353196-Potential_malicious_use_of_certutil""
| setfields detection_description = ""Det-3353196-Potential_malicious_use_of_certutil""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Defense Evasion"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3374103-Zscaler-Unusual-high-volume-of-uploaded-traffic-Potential-Exfil",axg3394,"send_to_sentinel",search,"5 * * * *","-1h@h","@h","index=zscaler login!=HUM_Guest action=allowed
| eval fqdn=lower(ehost)
| rex field=fqdn ""(?<domain>[a-z0-9\-]+\.[a-z]+)$""
| bucket _time span=1h
| eval reqsizeGB=reqsize/1024/1024/1024
| eval respsizeGB=respsize/1024/1024/1024
| stats sum(reqsizeGB) as reqsizeGBTotal sum(respsizeGB) as respsizeGBTotal values(fqdn) as FQDNs by _time domain
| search NOT domain IN(""windows.net"" ""sharepoint.com"" ""onenote.com"" ""azure.com"" ""azure-apim.net"" ""amazonaws.com"" ""purestorage.com"" ""googleapis.com"" ""cloudsink.net"" ""dell.com"" ""lenovo.com"" ""live.com"" ""galileosuite.com"" ""google.com"" ""gcr.io"" ""digitalguardian.com"" ""cisco.com"" ""rubrik.com"" ""thousandeyes.com"" ""windows.com"" ""easylink.com"" ""webexcontent.com"" ""zpath.net"" ""myshn.net"" ""snaplogic.com"" ""microsoft.com"" ""cogito.us"" ""forescoutcloud.net"" ""dynatrace.com"" ""contrastsecurity.com"" ""pure.cloud"" ""logicmonitor.com"" ""komprise.com"" ""azurecr.io"" ""hyperflex.io"" ""navihealth.us"" ""adnxs.com"" ""amazon.com"" ""milliman.com"" ""nr-data.net"" ""lakesidesoftware.com"" ""nuancehdp.com"" ""datadoghq.com"" ""wasabisys.com"" ""emc.com"" ""vmware.com"" ""launchdarkly.com"" ""ibm.com"" ""redhat.com"" ""oracle.com"" ""twistlock.com"" ""workfusion.com"" ""azuredatabricks.net"" ""mcafee.com"" ""visualstudio.com"" ""kaltura.com"" ""avaya.com"" ""yammer.com"" ""ariacec.com"" ""azurewebsites.net"" ""workfront.com"" ""percipio.com"" ""mulesoft.com"" ""humana.com"" ""force.com"" ""jamfcloud.com"" ""axway.com"" ""appspot.com"" ""perspectium.net""  ""arubanetworks.com"" ""caqh.org"" ""oraclevcn.com"" ""oraclecloud.com"" ""ucs-connect.com"" ""citrix.com"" ""paloaltonetworks.com"" ""verint.com"" ""automationanywhere.digital"" ""jfrog.io"" ""assets-yammer.com"" ""csod.com"" ""cms.gov"" ""proofhq.com"" ""youtube.com"" ""dropbox.com"" ""dropboxapi.com"" ""ncryptedcloud.com"" ""monday.com"" ""dynamics.com"" ""clarity.ms"" ""github.com"" ""perfectomobile.com"" ""activeops.com"" ""ankura.com"" ""brainshark.com"" ""buxtonco.com"" ""empirix.com"" ""intersight.com"" ""symplr.com"" ""ubiqus.com"" ""hindsait.com"" ""questanalytics.com"" ""solarwinds.com"" ""venafi.com"" ""sovos.com"" ""mypurecloud.com"" ""informatica.com"" ""azureml.ms"" ""cloudera.com"" ""hsag.com"")
| eval reqsizeGBTotal=round(reqsizeGBTotal,2) 
| eval respsizeGBTotal=round(respsizeGBTotal,2)
| eval domainMoreUpThanDown=if(reqsizeGBTotal > respsizeGBTotal, ""True"", ""False"")
| eval domainUpThan2xDown=if(reqsizeGBTotal > (respsizeGBTotal*2), ""True"", ""False"")
| search domainUpThan2xDown=""True""
| where reqsizeGBTotal >= 1.50
| table _time domain reqsizeGBTotal respsizeGBTotal FQDNs
| sort 0 - reqsizeGBTotal



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3374103-Zscaler-Unusual-high-volume-of-uploaded-traffic-Potential-Exfil""
| setfields detection_description = ""DET-3374103-Zscaler-Unusual-high-volume-of-uploaded-traffic-Potential-Exfil""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Exfiltration"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3400142-Zscaler-Activity-from-Foreign-Country",axg3394,"send_to_sentinel",search,"30 * * * *","-60m@m",now,"index=zscaler location=""Road Warrior"" dvc=""Zscaler Cloud Proxy"" vendor_product=Zscaler_ZIA_Proxy
| rename deviceappversion as ClientExternalIP
| rename deviceosversion as ClientDeviceModel
| rename devicename as ZSClientUUID
| iplocation ClientExternalIP
| search NOT Country IN(""United States"" ""Puerto Rico"")
| rex field=ClientDeviceModel ""(?<LenovoLikelyHUMAsset>[A-Z0-9]{10})$""
| fillnull value=NO LenovoLikelyHUMAsset
| stats values(ClientExternalIP) values(Country) values(ClientDeviceModel) values(ZSClientUUID) values(LenovoLikelyHUMAsset) by login




``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3400142-Zscaler-Activity-from-Foreign-Country""
| setfields detection_description = ""DET-3400142-Zscaler-Activity-from-Foreign-Country""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""InitialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3410091 Add Defender exclusion via powershell",sgb2991,"send_to_sentinel",search,"22 * * * *","-60m@m",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") Message IN (""*set-mppreference*"", ""*add-mppreference*"") AND Message=""*-Exclusion*"" Message!=""*\\heroku*"" Message!=""*\\.idea*"" Message!=""*\\JetBrains\\*"" Message!=""*IntelliJ*"" Message!=""*.gradle*""

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3410091 Add Defender exclusion via powershell""
| setfields detection_description = ""DET-3410091 Add Defender exclusion via powershell""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3444745-Suspicious_use_of_findstr_and_Cpassword",dtw4156,"send_to_sentinel",search,"49 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline =""*findstr*"" cmdline=""*cpassword*"" process_name !=""git.exe""

 
``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3444745-Suspicious_use_of_findstr_and_Cpassword""
| setfields detection_description = ""DET-3444745-Suspicious_use_of_findstr_and_Cpassword""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CredentialAccess"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""T1003,T1552.001""
``` END ```"
"DET-3444767-Suspicious_use_of_Sharpview_tool",dtw4156,"send_to_sentinel",search,"48 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""sharpview.exe""

 
``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3444767-Suspicious_use_of_Sharpview_tool""
| setfields detection_description = ""DET-3444767-Suspicious_use_of_Sharpview_tool""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""PrivilegeEscalation"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""T1055.001""
``` END ```"
"DET-3471720-Potential-Follina-exploitation-CVE-2022-30190",axg3394,"send_to_sentinel",search,"33 * * * *","-60m@m",now,"index=wineventlog source IN(""WinEventLog:Microsoft-Windows-Sysmon/Operational"" ""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=""1"" 
(Image=""\\msdt.exe"" CommandLine=""*IT_BrowseForFile*"" CommandLine=""*IT_LaunchMethod*"" (CommandLine=""*ms-msdt:/id*"" OR CommandLine=""*ms-msdt:-id*""))
| stats count by _time host user Image CommandLine ParentImage ParentCommandLine
| sort 0 + _time



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3471720-Potential-Follina-exploitation-CVE-2022-30190""
| setfields detection_description = ""DET-3471720-Potential-Follina-exploitation-CVE-2022-30190""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Execution"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3494083 reg save SAM hive",sgb2991,"send_to_sentinel",search,"25 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 Image=""*\\reg.exe"" CommandLine=""* save *"" CommandLine=""*\\sam*""



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3494083 reg save SAM hive""
| setfields detection_description = ""DET-3494083 reg save SAM hive""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3537071 WinRM Listener",sgb2991,"send_to_sentinel",search,"45 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 Image=""*\\cscript.exe"" CommandLine=""*Compatibility*"" CommandLine=""*winrm*""



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3537071 WinRM Listener""
| setfields detection_description = ""DET-3537071 WinRM Listener""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-3537748 MFSDLL Password Stealer",sgb2991,"send_to_sentinel",search,"46 * * * *","-60m@m",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 AND
(Image=""*\\mfsdll.exe"" 
OR CommandLine=""*.log domain""
OR CommandLine=""*.log dump""
OR CommandLine=""*.log password""
OR CommandLine=""*.log sam""
OR CommandLine=""*.log minidump"")


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3537748 MFSDLL Password Stealer""
| setfields detection_description = ""DET-3537748 MFSDLL Password Stealer""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"DET-Test Sentinel Integration test without ES",hel6342,"email, send_to_sentinel",search,"* * * * *","-1m",now,"| tstats count AS count min(_time) AS min_time max(_time) AS max_time
    where index=dns
    query{} = ""*.wutsec.sh""
    BY query{}, host_addr{}, src_ip
| eval max_time = strftime(max_time,""%Y-%m-%dT%H:%M:%S.%Q"") 
| eval min_time = strftime(min_time,""%Y-%m-%dT%H:%M:%S.%Q"")

``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-Test Sentinel Integration test without ES""
| setfields detection_description = ""Descriptive info about the detection""
| setfields severity = ""Medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""Probing"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
``` END ```"
"Threat - DET-1210224 win_account_backdoor_dcsync_rights - Rule",sgb2991,"send_to_sentinel",search,"40 * * * *","-1h",now,"index=wineventlog EventCode=5136 AttributeLDAPDisplayName=ntSecurityDescriptor AttributeValue=""1131f6ad-9c07-11d1-f79f-00c04fc2dcd2"" OR AttributeValue=""1131f6aa-9c07-11d1-f79f-00c04fc2dcd2"" OR AttributeValue=""89e95b76-444d-4c62-991a-0facbeda640c""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210224 win_account_backdoor_dcsync_rights""
| setfields detection_description = ""DET-1210224 win_account_backdoor_dcsync_rights""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210277-Suspicious_high_volume_DNS_queries - Rule",axg3394,"send_to_sentinel",search,"12 * * * *","-1h",now,"index=dns host IN(LOUDNSWPS14, LOUDNSWPS15, SIMDNSWPS14, SIMDNSWPS15, LOUDNSWPS08, LOUDNSWPS11, LOUDNSWPS12, SIMDNSWPS08, SIMDNSWPS11, SIMDNSWPS12, LOUDNSWPS09, LOUDNSWPS10, SIMDNSWPS09, SIMDNSWPS10, LOUDNSWPS06, LOUDNSWPS07, SIMDNSWPS06, SIMDNSWPS07) (src_ip!=193.52.0.0/15 AND src_ip!=10.32.0.0/12) query{}=""*.*"" earliest=-1h@h latest=@h
| bucket _time span=1h
| rename query{} as query
| eval fqdn=lower(query)
| rex field=fqdn ""(?<domain>[a-z0-9\-]+\.[a-z]+)$""
| search NOT domain IN(""humad.com"" ""dmzad.hum"" ""humana.com"" ""loutms.tree"" ""adea.hum"" ""humana.forest"" ""humadtest.hum"" ""mcafee.com"" ""barracudabrts.com"" ""cloudfront.net"" ""cloudflare.net"" ""appsechcl.com"" ""footprintdns.com"" ""googlesyndication.com"" ""mcafee.com"" ""office.com"" ""salesforceliveagent.com"" ""wbx2.com"" ""webex.com"" ""windows.net"" ""yammer.com"" ""akadns.net"" ""akamaiedge.net"" ""akamaihd.net"" ""akamai.net"" ""amazonaws.com"" ""azure.com"" ""azureedge.net"" ""azure.net"" ""azurewebsites.net"" ""casalemedia.com"" ""cloudapp.net"" ""google.com"" ""microsoft.com"" ""cedexis-radar.net"" ""edgekey.net"" ""googlevideo.com"" ""gstatic.com"" ""imrworldwide.com"" ""nessus.org"" ""trafficmanager.net"" ""salesforce.com"" ""zoom.us"" ""apple.com"" ""fastly.net"" ""yahoodns.net"" ""llnwd.net"" ""databricksusercontent.com"" ""dropboxusercontent.com"" ""ibm.com"" ""in-addr.arpa"" ""ip6.arpa"" ""clienttons.com"" ""doubleclick.net"")
| stats dc(query) as UniqueQueries values(query) as Queries by _time domain
| where UniqueQueries > 750


``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210277-Suspicious_high_volume_DNS_queries""
| setfields detection_description = ""DET-1210277-Suspicious_high_volume_DNS_queries""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = ""CommandAndControl"" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210278-Possible_CobaltStrike_DNS_Beacon(net_mal_dns_cobaltstrike) - Rule",axg3394,"send_to_sentinel",search,"13 * * * *","-1h",now,"| tstats count AS count min(_time) AS min_time max(_time) AS max_time values(src_ip) AS src_ips values(query{}) as query where index=dns query{} IN(""aaa.stage.*"" ""post.1*"") NOT query{} IN(""*.loutms.tree"" ""*.dmzad.hum"" ""*.humana.com"" ""*.humad.com"" ""*.loutms.com"")
| eval max_time = strftime(max_time,""%Y-%m-%dT%H:%M:%S.%Q"") 
| eval min_time = strftime(min_time,""%Y-%m-%dT%H:%M:%S.%Q"")
| where count>0
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210278-Possible_CobaltStrike_DNS_Beacon(net_mal_dns_cobaltstrike)""
| setfields detection_description = ""DET-1210278-Possible_CobaltStrike_DNS_Beacon(net_mal_dns_cobaltstrike)""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210280-net_susp_dns_txt_exec_strings - Rule",axg3394,"send_to_sentinel",search,"14 * * * *","-1h",now,"index=dns query_type{}=TXT (hostname{} IN(""*IEX*"" ""*Invoke-Expression*"" ""*cmd.exe*"") OR host_addr{} IN(""*IEX*"" ""*Invoke-Expression*"" ""*cmd.exe*""))
| search NOT src_ip IN (193.52.0.0/15, 10.32.0.0/12, 10.113.32.103, 10.113.32.219, 10.113.37.39, 10.113.37.40, 10.113.37.41, 10.113.37.42, 10.113.37.43, 10.113.37.44, 10.113.96.220, 10.113.96.23, 10.128.213.90, 10.129.245.222, 10.130.143.10, 10.210.0.72, 10.211.0.72, 10.211.0.73, 10.64.127.220, 10.64.255.220, 10.65.40.30, 10.65.40.31, 10.65.40.34, 10.65.40.35, 10.97.32.217, 10.97.32.42, 10.97.37.105, 10.97.37.106, 10.97.37.107, 10.97.37.108, 10.97.37.109, 10.97.37.110, 10.97.96.218, 10.97.96.84, 193.39.20.236, 193.42.115.237, 193.42.115.238, 193.44.134.232, 193.44.134.238, 193.44.134.239, 193.44.93.121, 193.44.93.240, 193.46.144.101, 193.46.64.236, 193.46.64.242, 193.46.80.201, 193.47.237.220, 193.47.57.11, 193.59.227.204, 193.91.153.40, 193.91.155.52, 193.91.159.150, 205.145.105.203, 205.145.113.245, 205.145.66.21, 205.145.66.22, 205.145.66.250, 205.145.66.29, 32.32.55.231, 32.32.56.232, 205.145.66.111)
| rename query_type{} as query_type
| rename query{} as query
| rename message_type{} as message_type
| mvexpand message_type
| search message_type=RESPONSE
| mvexpand host_type
| rename hostname{} as hostname
| rename host_type{} as host_type
| rename host_addr{} as host_addr
| fillnull value=""NULL"" hostname
| fillnull value=""NULL"" host_addr
| foreach * [| eval ""<<FIELD>>""=mvdedup('<<FIELD>>')]
| dedup _time src_ip query query_type message_type hostname host_type host_addr
| table _time src_ip query query_type message_type hostname host_type host_addr
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210280-net_susp_dns_txt_exec_strings""
| setfields detection_description = ""DET-1210280-net_susp_dns_txt_exec_strings""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210285-proxy_apt40 - Rule",axg3394,"send_to_sentinel",search,"16 * * * *","-1h",now,"index=zscaler ua=""Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36"" ehost=""api.dropbox.com""
| search login!=HUM_Guest
| stats count by _time cip login sip ehost eurlpath ua action
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210285-proxy_apt40""
| setfields detection_description = ""DET-1210285-proxy_apt40""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210286-proxy_chafer_malware - Rule",axg3394,"send_to_sentinel",search,"16 * * * *","-1h",now,"index=zscaler eurlpath=""*/asp.asp?ui=*""
| search login!=HUM_Guest
| stats count by _time cip login sip ehost eurlpath ua action
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210286-proxy_chafer_malware""
| setfields detection_description = ""DET-1210286-proxy_chafer_malware""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210287-CobaltStrike_Malleable_Amazon_Browsing_Traffic_Profile - Rule",axg3394,"send_to_sentinel",search,"17 * * * *","-1h",now,"index=zscaler (ua=""Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko"" reqmethod=""GET"" eurlpath=""/s/ref=nb_sb_noss_1/167-3294888-0262949/field-keywords=books"" ehost=""www.amazon.com"") OR (ua=""Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko"" reqmethod=""POST"" eurlpath=""/N4215/adj/amzn.us.sr.aps"") 
| table _time cip login reqmethod sip ehost eurlpath ua
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210287-CobaltStrike_Malleable_Amazon_Browsing_Traffic_Profile(proxy_cobalt_amazon)""
| setfields detection_description = ""DET-1210287-CobaltStrike_Malleable_Amazon_Browsing_Traffic_Profile(proxy_cobalt_amazon)""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210288-CobaltStrike_Malleable_(OCSP)_Profile(proxy_cobalt_ocsp) - Rule",axg3394,"send_to_sentinel",search,"18 * * * *","-1h",now,"index=zscaler ehost=""ocsp.verisign.com"" eurlpath=""*/oscp/*"" 
| table _time cip login sip ehost eurlpath
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210288-CobaltStrike_Malleable_(OCSP)_Profile(proxy_cobalt_ocsp)""
| setfields detection_description = ""DET-1210288-CobaltStrike_Malleable_(OCSP)_Profile(proxy_cobalt_ocsp)""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210289-proxy_cobalt_onedrive - Rule",axg3394,"send_to_sentinel",search,"38 * * * *","-1h",now,"index=zscaler login!=HUM_Guest ehost=""*onedrive.live.com*"" eurlpath=""*?manifest=wac*"" reqmethod=""GET"" ehost!=""onedrive.live.com""
| stats count by _time cip login action sip ehost eurlpath ua
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210289-proxy_cobalt_onedrive""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_wiki/wikis/Detections/7914/DET-1210289-proxy_cobalt_onedrive""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210290-proxy_downloadcradle_webdav - Rule",axg3394,"send_to_sentinel",search,"19 * * * *","-1h",now,"index=zscaler reqmethod=""GET"" ua=""Microsoft-WebDAV-MiniRedir/*"" 
| rex field=ehost ""(?<domain>[A-z0-9\-]+\.[A-z]+)$""
| search NOT domain IN(""sharepoint.com"" ""deloitteonline.com"" ""sysinternals.com"" ""aspect-cloud.net"")
| search login!=HUM_Guest
| stats count by _time cip login sip ehost eurlpath action
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210290-proxy_downloadcradle_webdav""
| setfields detection_description = ""DET-1210290-proxy_downloadcradle_webdav""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210291-proxy_download_susp_dyndns - Rule",axg3394,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=zscaler filesubtype IN(""bat"" ""bin"" ""cmd"" ""com"" ""cpl"" ""csh"" ""daa"" ""dll"" ""doc"" ""docm"" ""docx"" ""exe"" ""gadget"" ""hta"" ""inf1"" ""ins"" ""inx"" ""ipa"" ""isu"" ""job"" ""jse"" ""ksh"" ""msc"" ""msi"" ""msp"" ""mst"" ""paf"" ""pif"" ""pptm"" ""prg"" ""ps1"" ""rar"" ""reg"" ""rgs"" ""rtf"" ""scr"" ""sct"" ""shb"" ""shs"" ""u3p"" ""vb"" ""vbe"" ""vbs"" ""vbscript"" ""ws"" ""wsf"" ""wsh"" ""xls"" ""xlsm"" ""xlsx"" ""zip"") 
| search ehost IN(""*.hopto.org"" ""*.no-ip.org"" ""*.no-ip.info"" ""*.no-ip.biz"" ""*.no-ip.com"" ""*.noip.com"" ""*.ddns.name"" ""*.myftp.org"" ""*.myftp.biz"" ""*.sernvveblog.net"" ""*.servebeer.com"" ""*.servemp3.com"" ""*.serveftp.com"" ""*.servequake.com"" ""*.servehalflife.com"" ""*.servehttp.com"" ""*.servegame.com"" ""*.servepics.com"" ""*.myvnc.com"" ""*.ignorelist.com"" ""*.jkub.com"" ""*.dlinkddns.com"" ""*.jumpingcrab.com"" ""*.ddns.info"" ""*.mooo.com"" ""*.dns-dns.com"" ""*.strangled.net"" ""*.adultdns.net"" ""*.craftx.biz"" ""*.ddns01.com"" ""*.dns53.biz"" ""*.dnsapi.info"" ""*.dnsd.info"" ""*.dnsdynamic.com"" ""*.dnsdynamic.net"" ""*.dnsget.org"" ""*.fe100.net"" ""*.flashserv.net"" ""*.ftp21.net"" ""*.http01.com"" ""*.http80.info"" ""*.https443.com"" ""*.imap01.com"" ""*.kadm5.com"" ""*.mysq1.net"" ""*.ns360.info"" ""*.ntdll.net"" ""*.ole32.com"" ""*.proxy8080.com"" ""*.sql01.com"" ""*.ssh01.com"" ""*.ssh22.net"" ""*.tempors.com"" ""*.tftpd.net"" ""*.ttl60.com"" ""*.ttl60.org"" ""*.user32.com"" ""*.voip01.com"" ""*.wow64.net"" ""*.x64.me"" ""*.xns01.com"" ""*.dyndns.org"" ""*.dyndns.info"" ""*.dyndns.tv"" ""*.dyndns-at-home.com"" ""*.dnsomatic.com"" ""*.zapto.org"" ""*.webhop.net"" ""*.25u.com"" ""*.slyip.net"") 
| search login!=HUM_Guest
| stats count by _time cip login sip ehost eurlpath filesubtype filename action
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210291-proxy_download_susp_dyndns""
| setfields detection_description = ""DET-1210291-proxy_download_susp_dyndns""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210292-proxy_download_susp_tlds_blacklist - Rule",axg3394,"send_to_sentinel",search,"35 * * * *","-1h",now,"index=zscaler filename IN(""*.exe"" ""*.vbs"" ""*.bat"" ""*.rar"" ""*.ps1"" ""*.doc"" ""*.docm"" ""*.xls"" ""*.xlsm"" ""*.pptm"" ""*.rtf"" ""*.hta"" ""*.dll"" ""*.ws"" ""*.wsf"" ""*.sct"" ""*.zip"") ehost IN(""*country"" ""*stream"" ""*gdn"" ""*mom"" ""*xin"" ""*kim"" ""*men"" ""*loan"" ""*download"" ""*racing"" ""*online"" ""*science"" ""*ren"" ""*gb"" ""*win"" ""*top"" ""*review"" ""*vip"" ""*party"" ""*tech"" ""*xyz"" ""*date"" ""*faith"" ""*zip"" ""*cricket"" ""*space"" ""*info"" ""*vn"" ""*cm"" ""*am"" ""*cc"" ""*asia"" ""*ws"" ""*tk"" ""*biz"" ""*su"" ""*st"" ""*ro"" ""*ge"" ""*ms"" ""*pk"" ""*nu"" ""*me"" ""*ph"" ""*to"" ""*tt"" ""*name"" ""*tv"" ""*kz"" ""*tc"" ""*mobi"" ""*study"" ""*click"" ""*link"" ""*trade"" ""*accountant"" ""*cf"" ""*gq"" ""*ml"" ""*ga"" ""*pw"") NOT ehost IN(""aka.ms"" ""*.sfx.ms"" ""www.regtap.info"" ""mycourses.lawonline.me"") login!=HUM_Guest reqmethod=GET
| rex field=ehost ""(?<tld>\.[a-z]+)$""
| search tld IN("".country"" "".stream"" "".gdn"" "".mom"" "".xin"" "".kim"" "".men"" "".loan"" "".download"" "".racing"" "".online"" "".science"" "".ren"" "".gb"" "".win"" "".top"" "".review"" "".vip"" "".party"" "".tech"" "".xyz"" "".date"" "".faith"" "".zip"" "".cricket"" "".space"" "".info"" "".vn"" "".cm"" "".am"" "".cc"" "".asia"" "".ws"" "".tk"" "".biz"" "".su"" "".st"" "".ro"" "".ge"" "".ms"" "".pk"" "".nu"" "".me"" "".ph"" "".to"" "".tt"" "".name"" "".tv"" "".kz"" "".tc"" "".mobi"" "".study"" "".click"" "".link"" "".trade"" "".accountant"" "".cf"" "".gq"" "".ml"" "".ga"" "".pw"")
| eval time=strftime(_time,""%Y-%m-%dT %H:%M:%S.%Z"")  
| stats count by time action cip login reqmethod sip ehost filesubtype filename eurl ua
| sort 0 + time
| stats sum(count) as loginCIPCount list(count) as requestCount list(time) as time list(action) as action list(reqmethod) as reqmethod list(sip) as sip list(ehost) as ehost list(filesubtype) as filesubtype list(filename) as filename list(eurl) as eurl list(ua) as ua by cip login
| sort 0 - loginCIPCount
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210292-proxy_download_susp_tlds_blacklist""
| setfields detection_description = ""Detects download of certain risky filetypes from suspicious TLDs.""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210298-proxy_susp_flash_download_loc - Rule",axg3394,"send_to_sentinel",search,"37 * * * *","-1h",now,"index=zscaler login!=HUM_Guest eurlpath IN(""*/install_flash_player.exe*"" ""*/flash_install.php*"") NOT ehost IN(""*.adobe.com"" ""adobe.com"")
| stats count by _time cip login action sip ehost eurlpath ua
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210298-proxy_susp_flash_download_loc""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_wiki/wikis/Detections/7915/DET-1210298-proxy_susp_flash_download_loc""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210299-proxy_telegram_api - Rule",axg3394,"send_to_sentinel",search,"37 * * * *","-1h",now,"index=zscaler login!=HUM_Guest ehost=""api.telegram.org"" NOT ua IN(""*Telegram*"" ""*Bot*"")
| stats count by _time cip login action sip ehost eurlpath ua
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210299-proxy_telegram_api""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_wiki/wikis/Detections/7916/DET-1210299-proxy_telegram_api""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210301-Anomalous_BITS_Traffic(proxy_ua_bitsadmin_susp_tld) - Rule",axg3394,"send_to_sentinel",search,"40 * * * *","-1h",now,"index=zscaler login!=HUM_Guest ua=""Microsoft BITS/*""
| rex field=ehost ""(?<domain>[a-z0-9\-]+\.[a-z]+)$""
| search NOT domain IN(""gvt1.com"" ""live.com"" ""microsoft.com"" ""windowsupdate.com"" ""googleapis.com"" ""azureedge.net"" ""docker.com"" ""adobe.com"" ""think-cell.com"" ""google.com"" ""virtualearth.net"" ""thousandeyes.com"" ""worldshipmedia.com"" ""autodesk.com"" ""msn.com"" ""s-msn.com"" ""mozilla.net"" ""sysinternals.com"" ""aka.ms"" ""postsharp.net"" ""office365.com"" ""lenovo.com"" ""mozilla.org"" ""dell.com"" ""nero.com"" ""bing.com"" ""qs1.com"" ""xamarin.com"" ""sfx.ms"" ""network-auth.com"" ""python.org"" ""humad.com"" ""humana.com"" ""hp.com"" ""apache.org"" ""att.com"" ""oracle.com"" ""highfive.com"" ""x2go.org"" ""dropbox.com"" ""nodejs.org"" ""mobatek.net"" ""office.net"" ""c-ij.com"" ""c-wss.com"") NOT ehost IN(""*microsoft-com.akamaized.net"" ""img-s-msn-com.akamaized.net"" ""officecdn.microsoft.com.edgesuite.net"") NOT(ehost=""*.s.loris.llnwd.net"" AND ehost=""*-windowsupdate*"")
| search domain!=cloudfront.net AND eurlpath!=""/prod/win/v*/highfiveapp.msi""
| stats count by _time login cip domain eurl
| sort 0 - count
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210301-Anomalous_BITS_Traffic(proxy_ua_bitsadmin_susp_tld)""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_workitems/edit/1210301""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210302-proxy_ua_cryptominer - Rule",axg3394,"send_to_sentinel",search,"21 * * * *","-1h",now,"index=zscaler login!=HUM_Guest ua IN(""XMRig*"" ""ccminer*"")
| stats count by _time cip login sip ehost ua action
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210302-proxy_ua_cryptominer""
| setfields detection_description = ""DET-1210302-proxy_ua_cryptominer""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210309-Ursnif_Malware_Download_URL_Pattern(proxy_ursnif_malware) - Rule",axg3394,"send_to_sentinel",search,"22 * * * *","-1h",now,"index=zscaler (eurlpath=""*/*.php?l=*.cab"" respcode=""200"")
| table _time cip login proto reqmethod respcode filesubtype sip ehost eurlpath ua
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210309-Ursnif_Malware_Download_URL_Pattern(proxy_ursnif_malware)""
| setfields detection_description = ""DET-1210309-Ursnif_Malware_Download_URL_Pattern(proxy_ursnif_malware)""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210326 win_alert_mimikatz_keywords - Rule",sgb2991,"email, send_to_sentinel",search,"13 * * * *","-1h",now,"index=wineventlog SourceName!=""McAfee Endpoint Security"" source!=""WinEventLog:TITUS/Operational"" EventCode!=2001 mimikatz OR mimilib OR ""*<3 eo.oe*"" OR eo.oe.kiwi OR privilege::debug OR sekurlsa::logonpasswords OR lsadump::sam OR mimidrv.sys OR p::d OR s::l
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210326 win_alert_mimikatz_keywords""
| setfields detection_description = ""DET-1210326 win_alert_mimikatz_keywords""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210362-win_susp_dhcp_config_failed - Rule",axg3394,"send_to_sentinel",search,"41 * * * *","-1h",now,"index=wineventlog source IN(""WinEventLog:System"" ""XmlWinEventLog:System"") EventCode IN(""1031"" ""1032"" ""1034"") *dhcp*
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210362-win_susp_dhcp_config_failed""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_wiki/wikis/Detections/9815""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210363-win_susp_dhcp_config - Rule",axg3394,"send_to_sentinel",search,"42 * * * *","-1h",now,"index=wineventlog source IN(""WinEventLog:System"" ""XmlWinEventLog:System"") EventCode IN(""1033"") *dhcp*
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210363-win_susp_dhcp_config""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_wiki/wikis/Detections/9816""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210396 win_mal_ryuk - Rule",sgb2991,"send_to_sentinel",search,"30 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""net.exe"" OR process_name=""net1.exe"") cmdline=""*stop*"" AND (cmdline=""*samss*"" OR cmdline=""*audioendpointbuilder*"" OR cmdline=""*unistoresvc_?????"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210396 win_mal_ryuk""
| setfields detection_description = ""DET-1210396 win_mal_ryuk""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210478 win malware emotet-1 - Rule",sgb2991,"send_to_sentinel",search,"45 * * * *","-1h",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") EventCode=4104 AND (Message=""*JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ*"" OR Message=""*QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA*"" OR Message=""*kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA*"" OR Message=""*IgAoACcAKgAnACkAOwAkA*"" OR Message=""*IAKAAnACoAJwApADsAJA*"" OR Message=""*iACgAJwAqACcAKQA7ACQA*"" OR Message=""*JABGAGwAeAByAGgAYwBmAGQ*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210478 win malware emotet-1""
| setfields detection_description = ""DET-1210478 win malware emotet-1""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1059.001']""
``` END ```"
"Threat - DET-1210478 win malware emotet-2 - Rule",sgb2991,"send_to_sentinel",search,"45 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (cmdline=""*JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ*"" OR cmdline=""*QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA*"" OR cmdline=""*kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA*"" OR cmdline=""*IgAoACcAKgAnACkAOwAkA*"" OR cmdline=""*IAKAAnACoAJwApADsAJA*"" OR cmdline=""*iACgAJwAqACcAKQA7ACQA*"" OR cmdline=""*JABGAGwAeAByAGgAYwBmAGQ*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210478 win malware emotet-2""
| setfields detection_description = ""DET-1210478 win malware emotet-2""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1059.001']""
``` END ```"
"Threat - DET-1210481 win malware qbot - Rule",sgb2991,"send_to_sentinel",search,"45 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (parent_process_name=""winrar.exe"" AND process_name=""wscript.exe"") OR (cmdline=""*regsvr32.exe*"" AND cmdline=""*c:\\programdata*"" AND cmdline=""*.tmp*"") OR (cmdline=""*ping.exe -n 6 127.0.0.1 & type*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210481 win malware qbot""
| setfields detection_description = ""DET-1210481 win malware qbot""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1059.003']""
``` END ```"
"Threat - DET-1210482 win_malware_ryuk - Rule",sgb2991,"send_to_sentinel",search,"50 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*C:\\Users\\Public\\*"" cmdline=""*CurrentVersion\\Run*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210482 win_malware_ryuk""
| setfields detection_description = ""DET-1210482 win_malware_ryuk""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210506 win_powersploit_empire_schtasks - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""schtasks.exe"" parent_process_name=""powershell.exe"" AND (cmdline=""*/Create*"" AND cmdline=""*/SC*"") AND ((cmdline=""*ONLOGON*"" OR cmdline=""*DAILY*"" OR cmdline=""*ONIDLE*"" OR cmdline=""*Updater*"") AND cmdline=""*/TN*"" AND cmdline=""*/TR*"" AND cmdline=""*powershell*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210506 win_powersploit_empire_schtasks""
| setfields detection_description = ""DET-1210506 win_powersploit_empire_schtasks""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1210692 Robbinhood - Rule",sgb2991,"send_to_sentinel",search,"45 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=cmd.exe parent_process_name=winlogon.exe AND (cmdline=""*taskkill*"" OR cmdline=""*net*"" OR cmdline=""*robbin*"" OR cmdline=""*vssadmin*"" OR cmdline=""*bcdedit*"" OR cmdline=""*wevtutil*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1210692 Robbinhood""
| setfields detection_description = ""DET-1210692 Robbinhood""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1214577-Emotet-Powershell-Detection-Feb-2020 - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") EventCode=4104 ((Message=""* -e JAB*"" OR Message=""* -e  JAB*"" OR Message=""* -e   JAB*"" OR Message=""* -e    JAB*"" OR Message=""* -e     JAB*"" OR Message=""* -e      JAB*"" OR Message=""* -en JAB*"" OR Message=""* -enc JAB*"" OR Message=""* -enc* JAB*"" OR Message=""* -w hidden -e* JAB*"" OR Message=""* BA^J e-"" OR Message=""* -e SUVYI*"" OR Message=""* -e aWV4I*"" OR Message=""* -e SQBFAFgA*"" OR Message=""* -e aQBlAHgA*"" OR Message=""* -enc SUVYI*"" OR Message=""* -enc aWV4I*"" OR Message=""* -enc SQBFAFgA*"" OR Message=""* -enc aQBlAHgA*"") NOT (Message=""* -ExecutionPolicy remotesigned *""))
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1214577-Emotet-Powershell-Detection-Feb-2020""
| setfields detection_description = ""DET-1214577-Emotet-Powershell-Detection-Feb-2020""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1214578-Gigya-Reset-Password-Spike - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=web_auth endpoint=accounts.resetPassword
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1214578-Gigya-Reset-Password-Spike""
| setfields detection_description = ""DET-1214578-Gigya-Reset-Password-Spike""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1214579-Invalid-LoginID-Spike - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=web_auth sourcetype=prod_go365 errMessage=""Invalid LoginID"" NOT ip=""205.145.107.*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1214579-Invalid-LoginID-Spike""
| setfields detection_description = ""DET-1214579-Invalid-LoginID-Spike""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1214581-PowerSploit-PowerView-Usage - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") EventCode=4104 harmj0y
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1214581-PowerSploit-PowerView-Usage""
| setfields detection_description = ""DET-1214581-PowerSploit-PowerView-Usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1214582-Syferlock-Fail-Spike - Rule",sgb2991,"send_to_sentinel",search,"*/15 * * * *","-15m",now,"index=syferlock fail
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1214582-Syferlock-Fail-Spike""
| setfields detection_description = ""DET-1214582-Syferlock-Fail-Spike""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1214583-rar.exe-Procress-Creation - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=wineventlog sourcetype=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"" EventCode=1 process_name=""rar.exe""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1214583-rar.exe-Procress-Creation""
| setfields detection_description = ""DET-1214583-rar.exe-Procress-Creation""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1441067-SocGholish - Rule",sgb2991,"email, send_to_sentinel",search,"13 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=wscript.exe cmdline=""*firefox.update*"" OR cmdline=""*chrome.update*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1441067-SocGholish""
| setfields detection_description = ""DET-1441067-SocGholish""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1543813-AnyConnect_VPN_from_foreign_country - Rule",axg3394,"send_to_sentinel",search,"23 * * * *","-1h",now,"index=cisco_anyconnect (Cisco_ASA_message_id=""722055"" OR Cisco_ASA_message_id=""722051"") NOT src_ip IN(170.205.128.0/18 217.180.192.0/18 162.0.192.0/20 134.195.20.0/22 130.51.196.0/22 199.168.124.0/22 23.168.240.0/24 134.195.28.0/22)
| iplocation src_ip
| search Country!=""United States"" Country!=""Puerto Rico""
| table _time Cisco_ASA_message_id user src_ip Country City Region host
| sort 0 - _time
| eval ip = src_ip
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1543813-AnyConnect_VPN_from_foreign_country""
| setfields detection_description = ""DET-1543813-AnyConnect_VPN_from_foreign_country""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1572329-Possible_base64_DNS_Exfil - Rule",axg3394,"send_to_sentinel",search,"24 * * * *","-1h",now,"index=dns host IN(LOUDNSWPS06 LOUDNSWPS07 LOUDNSWPS08 LOUDNSWPS09 LOUDNSWPS10 LOUDNSWPS11 LOUDNSWPS12 LOUDNSWPS13 LOUDNSWPS14 LOUDNSWPS15 SIMDNSWPS06 SIMDNSWPS07 SIMDNSWPS08 SIMDNSWPS09 SIMDNSWPS10 SIMDNSWPS11 SIMDNSWPS12 SIMDNSWPS13 SIMDNSWPS14 SIMDNSWPS15) message_type{}=RESPONSE AND reply_code IN(NoError NXDomain) AND query_type{} IN(A CNAME TXT AAAA) AND (src_ip!=193.52.0.0/15 AND src_ip!=10.32.0.0/12) query{} IN( ""*/*"" ""*=*"" ""*+*"")
| rename query{} AS query
| rex field=query ""\.(?<domain>[A-z0-9\-]+\.[A-z]+)$""
| rex field=query ""(?<hostsubdomain>^.+?(?=([A-z0-9\-]+\.[A-z]+)$))""
| search (hostsubdomain=""*/*"" OR hostsubdomain=""*=*"" OR hostsubdomain=""*+*"") AND hostsubdomain!=""*:*""
| mvexpand message_type
| search message_type=RESPONSE
| search NOT domain IN(wordpress.com barracuda.com humana.com loutms.com humad.com loutms.tree dmzad.hum anvitahealth.local certifydatasystems.com)
| search (domain!=microsoft.com AND hostsubdomain!=""*.reddog."")
| foreach * [| eval ""<<FIELD>>""=mvdedup('<<FIELD>>')]
| search NOT src_ip IN (10.113.32.103, 10.113.32.219, 10.113.37.39, 10.113.37.40, 10.113.37.41, 10.113.37.42, 10.113.37.43, 10.113.37.44, 10.113.96.220, 10.113.96.23, 10.128.213.90, 10.129.245.222, 10.130.143.10, 10.210.0.72, 10.211.0.72, 10.211.0.73, 10.64.127.220, 10.64.255.220, 10.65.40.30, 10.65.40.31, 10.65.40.34, 10.65.40.35, 10.97.32.217, 10.97.32.42, 10.97.37.105, 10.97.37.106, 10.97.37.107, 10.97.37.108, 10.97.37.109, 10.97.37.110, 10.97.96.218, 10.97.96.84, 193.39.20.236, 193.42.115.237, 193.42.115.238, 193.44.134.232, 193.44.134.238, 193.44.134.239, 193.44.93.121, 193.44.93.240, 193.46.144.101, 193.46.64.236, 193.46.64.242, 193.46.80.201, 193.47.237.220, 193.47.57.11, 193.59.227.204, 193.91.153.40, 193.91.155.52, 193.91.159.150, 205.145.105.203, 205.145.113.245, 205.145.66.21, 205.145.66.22, 205.145.66.250, 205.145.66.29, 32.32.55.231, 32.32.56.232, 205.145.66.111)
| search hostsubdomain!=""IGlzYnBsYzAxOyBpc2JlZHcwNA==*""
| search NOT query IN(""internal/deps/acorn/acorn/dist/acorn.js"")
| eval length=len(hostsubdomain) 
| where length >=6
| dedup _time query src_ip
| table _time query src_ip
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1572329-Possible_base64_DNS_Exfil""
| setfields detection_description = ""DET-1572329-Possible_base64_DNS_Exfil""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1580353-Cobalt-Strike-C2-IP-DNS-Resolution - Rule",hel6342,"send_to_sentinel",search,"31 * * * *","-1h",now,"| tstats count AS count min(_time) AS min_time max(_time) AS max_time values(src_ip) AS src_ips
    where index=dns
    NOT reply_code = ""NXDomain""
    NOT query{} IN (""*.humana.com"" ""*.humad.com"" ""*.arpa"" ""_kerberos.com"" ""_kerberos.tree"" ""*.azure.com.d.bl.barracudabrts.com"" ""*.sophosxl.net"" ""*.mcafee.com"" ""*.tree"" ""*.forest"" ""*.hum"" ""*.reddog.microsoft.com"" ""."" ""*pool.ntp.org"" ""*.local"" ""*.loutms.com"" ""*.home"" ""*.lan"")
    NOT host IN (""*dnswps*"")
    NOT query_type{} IN (""PTR"" ""TKEY"")
    [
        | inputlookup cobalt-consolidated.csv 
        | eval lastSeen_d = strptime(lastSeen, ""%m/%d/%Y %H:%M"")
        | where lastSeen_d >= relative_time(now(), ""-1y@d"" )
        | rename ip AS host_addr{} 
        | fields category, firstSeen, lastSeen, host_addr{}, tag, value
    ]
    BY host_addr{},query{}
| eval max_time = strftime(max_time,""%Y-%m-%dT%H:%M:%S.%Q"") 
| eval min_time = strftime(min_time,""%Y-%m-%dT%H:%M:%S.%Q"")
| join host_addr{} [
    | inputlookup cobalt-consolidated.csv 
    | eval lastSeen_d = strptime(lastSeen, ""%m/%d/%Y %H:%M"")
    | where lastSeen_d >= relative_time(now(), ""-1y@d"" )
    | rename ip AS host_addr{} 
    | fields category, firstSeen, lastSeen, host_addr{}, tag, value
]
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1580353-Cobalt-Strike-C2-IP-DNS-Resolution""
| setfields detection_description = ""Detects DNS resolution with a Cobalt Strike C2 IP reply.""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1071']""
``` END ```"
"Threat - DET-1593478-MDAV-Disable - Rule",sgb2991,"send_to_sentinel",search,"13 * * * *","-1h",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") set-mppreference AND DisableRealtimeMonitoring AND User!=""afq1883*"" AND User!=""tjw6015*"" NOT Cmdletization NOT Disable_Defender_Srv.ps1 
| table _time, host, User, Message
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1593478-MDAV-Disable""
| setfields detection_description = ""DET-1593478-MDAV-Disable""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1650945 RunDLL32 StartW export for Cobalt Strike - Rule",sgb2991,"send_to_sentinel",search,"13 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") Description=""Windows host process (Rundll32)"" cmdline=""*StartW*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1650945 RunDLL32 StartW export for Cobalt Strike""
| setfields detection_description = ""DET-1650945 RunDLL32 StartW export for Cobalt Strike""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1654828 Suspicious Powershell Cmdlets - Rule",sgb2991,"send_to_sentinel",search,"13 * * * *","-1h",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") 
""*Get-PPPassword*"" OR ""*Invoke-AllChecks*"" OR ""*Invoke-BloodHound*"" OR ""*Invoke-EternalBlue*"" OR ""*Invoke-FileFinder*"" OR ""*Invoke-HostRecon*"" OR ""*Invoke-Inveigh*"" OR ""*Invoke-Kerberoast*"" OR ""*Invoke-LoginPrompt*"" OR ""*Invoke-mimikittenz*"" OR ""*Invoke-ShareFinder*"" OR ""*Invoke-UserHunter*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1654828 Suspicious Powershell Cmdlets""
| setfields detection_description = ""DET-1654828 Suspicious Powershell Cmdlets""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1662672 nltest domain info enumeration - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""nltest.exe"" user!=""*bxd3703*"" user!=""*rjs1383*"" user!=""*jhf4335*"" user!=""*gxk9084*"" user!=""*rla7224*"" user!=""*dps5415s*"" AND (cmdline=""*/domain_trusts /all_trusts"" OR cmdline=""*/dclist:*"" OR cmdline=""*domain trusts"") ParentCommandLine!=""*QQBuAHMAaQBiAGwAZQB*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1662672 nltest domain info enumeration""
| setfields detection_description = ""DET-1662672 nltest domain info enumeration""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1662689 net group usage for enumeration - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (Image=*\\net.exe OR Image=*\\net1.exe) AND CommandLine=""*group \""domain admins\"" /dom*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1662689 net group usage for enumeration""
| setfields detection_description = ""DET-1662689 net group usage for enumeration""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1662694 Adfind usage for enumeration - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=adf.bat OR process_name=adfind.exe
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1662694 Adfind usage for enumeration""
| setfields detection_description = ""DET-1662694 Adfind usage for enumeration""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1662758 Bazar scheduled task StartAd - Rule",sgb2991,"send_to_sentinel",search,"24 * * * *","-1h",now,"index=wineventlog EventCode=4698 TaskName=""*StartAd*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1662758 Bazar scheduled task StartAd""
| setfields detection_description = """"
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1662789 Bazar adobe.link file usage - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") 
EventCode=11 file_name=""adobe.lnk"" file_path=""*start menu*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1662789 Bazar adobe.link file usage""
| setfields detection_description = ""DET-1662789 Bazar adobe.link file usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1663051 Anchor cmd usage - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=cmd.exe AND (cmdline=""*/c timeout 1 && del C:\\Users\\*"" OR cmdline=""*/C PowerShell 'Start-Sleep 5; Remove-Item C:\\Users\\*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1663051 Anchor cmd usage""
| setfields detection_description = ""DET-1663051 Anchor cmd usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1663459 Ryuk specific command line usage for WMIC BITS transfer - Rule",sgb2991,"send_to_sentinel",search,"30 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=WMIC.exe cmdline=""*@C:\\*\\comps1.txt*"" AND cmdline=""*cmd /c bitsadmin /transfer vVv*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1663459 Ryuk specific command line usage for WMIC BITS transfer""
| setfields detection_description = ""DET-1663459 Ryuk specific command line usage for WMIC BITS transfer""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1105']""
``` END ```"
"Threat - DET-1663463 Ryuk specific command line usage for COPY command via PsExec - Rule",sgb2991,"send_to_sentinel",search,"35 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=psexec.exe cmdline=""*@C:\\*\\comps1.txt*"" AND cmdline=""*cmd /c copy *vVv*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1663463 Ryuk specific command line usage for COPY command via PsExec""
| setfields detection_description = ""DET-1663463 Ryuk specific command line usage for COPY command via PsExec""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1570']""
``` END ```"
"Threat - DET-1663471 Ryuk specific command for remote execution with PsExec - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=psexec.exe cmdline=""*-d @C:\\*\\comps1.txt*"" AND cmdline=""*cmd /c c:\\windows\\temp\\vVv.exe""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1663471 Ryuk specific command for remote execution with PsExec""
| setfields detection_description = ""DET-1663471 Ryuk specific command for remote execution with PsExec""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1021.002']""
``` END ```"
"Threat - DET-1663563 Ryuk shadow copy deleted via WMIC - Rule",sgb2991,"send_to_sentinel",search,"45 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=WMIC.exe cmdline=""*shadowcopy delete""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1663563 Ryuk shadow copy deleted via WMIC""
| setfields detection_description = ""DET-1663563 Ryuk shadow copy deleted via WMIC""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1490']""
``` END ```"
"Threat - DET-1663569 VSSAdmin shadowcopy delete usage - Rule",sgb2991,"send_to_sentinel",search,"11 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=vssadmin.exe AND (cmdline=""*delete*"" OR ""*resize*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1663569 VSSAdmin shadowcopy delete usage""
| setfields detection_description = ""DET-1663569 VSSAdmin shadowcopy delete usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1679588-Suspected_Humana.com_Authentication_Abuse - Rule",hel6342,"send_to_sentinel",search,"38 * * * *","-1h",now,"index=shape sourcetype=shape_prod_web request=""https://www.humana.com/logon/"" requestMethod=POST
    NOT asn IN (""CNCS-AS"" ""HUM-*"")
    NOT attackCause IN (""Token Expired"" ""Token Missing"")
    NOT accountInfo IN (""EMPTY USERNAME"" """")
| eval accountInfo=upper(trim(accountInfo))
| eval isSuccessLogon=if(prCode==302 AND match(isAttack, ""false""), ""TRUE"", ""FALSE"")
| eval successAccount=if( match(isSuccessLogon, ""TRUE""), accountInfo, null())
| bin _time AS bintime span=1h
| stats 
    count AS requestCount
    count(eval(match(isSuccessLogon, ""TRUE""))) AS successCount
    count(eval(match(isSuccessLogon, ""FALSE""))) AS failCount 
    count(eval(match(isAttack, ""true""))) AS attackFlaggedCount
    dc(successAccount) AS successAccountsCount
    values(successAccount) AS successAccounts
    dc(accountInfo) AS accountInfoCount
    values(accountInfo) AS accountInfos
    values(attackCause) AS attackCauses
    dc(src) AS srcCount
    values(src) AS srcs
    count(eval(match(agentLabel, ""Illegitimate""))) AS illegitUaCount
    values(asn) AS asns
    dc(asn) AS asnCount
    BY requestClientApplication

| eval nonattackFailCount = failCount - attackFlaggedCount
| eval nonattackSuccessRatio = successCount / (nonattackFailCount + successCount)
| eval successRatio = successCount / requestCount
| eval successAccountsRatio = successAccountsCount / (successAccountsCount + accountInfoCount)

| where attackFlaggedCount > 0
| where accountInfoCount > 1
| where successRatio < 0.5 and successCount != 0
| where nonattackSuccessRatio <= 0.25 and nonattackFailCount > 0

| sort -accountInfoCount
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1679588-Suspected_Humana.com_Authentication_Abuse""
| setfields detection_description = ""DET-1679588-Suspected_Humana.com_Authentication_Abuse""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1110.004']""
``` END ```"
"Threat - DET-1690383-Ursnif_Malware_C2_URL_Pattern(proxy_ursnif_malware) - Rule",axg3394,"send_to_sentinel",search,"32 * * * *","-1h",now,"index=zscaler (eurlpath=""*.avi"" AND eurlpath=""*/images/*"") AND (eurlpath=""*_2f*"" OR eurlpath=""*_2b*"")
| table _time cip login ehost eurlpath bytes ua
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1690383-Ursnif_Malware_C2_URL_Pattern(proxy_ursnif_malware)""
| setfields detection_description = ""DET-1690383-Ursnif_Malware_C2_URL_Pattern(proxy_ursnif_malware)""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1862143-Potential_Unauthorized_device_on_Aruba - Rule",axg3394,"email, send_to_sentinel",search,"33 * * * *","-1h",now,"index=infoblox DHCPOFFER 
| multikv noheader=t
| search DHCPOFFER
| rex field=_raw ""(?<dhcp_type>DHCPOFFER)\son\s(?<dest>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\sto\s(?<dest_mac>[0-9a-zA-Z]{2}(?:\:[0-9a-zA-Z]{2}){5})\s(?:\((?<dest_hostname>[^\)]+)?\)\s)?via\s(\S+)\srelay\s(\S+)\slease\-duration\s(\d+)""
| search 
    dest IN(10.50.0.0/19 10.50.32.0/19 10.50.64.0/19 10.50.96.0/19 10.52.0.0/14 10.60.0.0/14 10.58.0.0/19 10.58.32.0/19 10.58.64.0/19 10.58.96.0/19 10.49.0.0/16) 
    NOT dest_hostname IN(WKMP* WKMJ* WKPC* WKPF* WKR9* MKC* AVX* SEP* SIMXDW* LOUXDW* WKHGB* TRMP* TRMJ* TRPC* TRPF* TRR9* IGEL* ""WM"" AVB* ITC* AVAEF773A ""WKTNEX111007"")
    NOT dest_hostname IN(""WK5CG1264T1Q"" ""WK5CG1264T2J"" ""WK5CG14511VH"" ""WK5CG14600SK"") ```Exclude random HP devices since their serial numbers don't line up with Lenovo and Dell patterns```
| rex field=dest_hostname ""(?<humsurface>WK[0-9]{12})$""
| search NOT humsurface=*
| rex field=dest_hostname ""(?<humdell>WK[A-Z0-9]{7})$""
| search NOT humdell=*
| stats  count by dest dest_hostname dest_mac
| sort 0 - count
| stats list(count) as IPCount list(dest) as DeviceIP list(dest_mac) as DeviceMAC by dest_hostname
| sort 0 - IPCount
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1862143-Potential_Unauthorized_device_on_Aruba""
| setfields detection_description = ""DET-1862143-Potential_Unauthorized_device_on_Aruba""
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-1973124-DNS-Unusual_high_volume_of_TXT_records - Rule",axg3394,"send_to_sentinel",search,"34 * * * *","-1h",now,"| tstats count where index=dns query_type{}=TXT host IN(LOUDNSWPS06 LOUDNSWPS07 LOUDNSWPS08 LOUDNSWPS09 LOUDNSWPS10 LOUDNSWPS11 LOUDNSWPS12 LOUDNSWPS13 LOUDNSWPS14 LOUDNSWPS15 SIMDNSWPS06 SIMDNSWPS07 SIMDNSWPS08 SIMDNSWPS09 SIMDNSWPS10 SIMDNSWPS11 SIMDNSWPS12 SIMDNSWPS13 SIMDNSWPS14 SIMDNSWPS15) NOT src_ip IN (10.113.32.103, 10.113.32.219, 10.113.37.39, 10.113.37.40, 10.113.37.41, 10.113.37.42, 10.113.37.43, 10.113.37.44, 10.113.96.220, 10.113.96.23, 10.128.213.90, 10.129.245.222, 10.130.143.10, 10.210.0.72, 10.211.0.72, 10.211.0.73, 10.64.127.220, 10.64.255.220, 10.65.40.30, 10.65.40.31, 10.65.40.34, 10.65.40.35, 10.97.32.217, 10.97.32.42, 10.97.37.105, 10.97.37.106, 10.97.37.107, 10.97.37.108, 10.97.37.109, 10.97.37.110, 10.97.96.218, 10.97.96.84, 193.39.20.236, 193.42.115.237, 193.42.115.238, 193.44.134.232, 193.44.134.238, 193.44.134.239, 193.44.93.121, 193.44.93.240, 193.46.144.101, 193.46.64.236, 193.46.64.242, 193.46.80.201, 193.47.237.220, 193.47.57.11, 193.59.227.204, 193.91.153.40, 193.91.155.52, 193.91.159.150, 205.145.105.203, 205.145.113.245, 205.145.66.21, 205.145.66.22, 205.145.66.250, 205.145.66.29, 32.32.55.231, 32.32.56.232, 205.145.66.111) by query{} src_ip
| search src_ip!=""10.32.0.0/12"" src_ip!=""193.52.0.0/15""
| rename query{} as query
| eval fqdn=lower(query)
| rex field=fqdn ""(?<domain>[a-z0-9\-]+\.[a-z]+)$""
| search NOT domain IN(""*.local"" ""*.localnet"" ""*.localdomain"" humad.com humana.com dmzad.hum barracudabrts.com humana.forest loutms.tree loutms.com anvitahealth.com certifydatasystems.com transcendinsights.com phpi.tree sophosxl.net mongodb.net apple.com powerdns.com version.bind clamav.net humgov.com onlinesecuremail.com)
| search NOT query IN(""_aaplcache._tcp.*"", ""_aaplcache1._tcp.*"", ""_aaplcache2._tcp.*"", ""_aaplcache3._tcp.*"" ""_aaplcache4._tcp.*"", ""_kerberos.*"", ""_cloud-netblocks.googleusercontent.com"", ""_cloud-netblocks1.googleusercontent.com"", ""_cloud-netblocks2.googleusercontent.com"", ""_cloud-netblocks3.googleusercontent.com"", ""_cloud-netblocks4.googleusercontent.com"", ""_cloud-netblocks5.googleusercontent.com"", ""_cloud-netblocks6.googleusercontent.com"", ""_cloud-netblocks7.googleusercontent.com"", ""_netblocks.google.com"". ""_netblocks1.google.com"". ""_netblocks2.google.com"". ""_netblocks3.google.com"", ""_netblocks4.google.com"", ""_netblocks5.google.com"", ""_netblocks6.google.com"", ""_netblocks7.google.com"", ""_netblocks8.google.com"", ""spf.protection.outlook.com"", ""spfd.protection.outlook.com"", ""jetbrains-license-server.*"", ""_jetbrains-license-server.*"")
| stats  values(query) as queryValues dc(query) as uniqueQuery by src_ip domain
| where uniqueQuery >=2



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-1973124-DNS-Unusual_high_volume_of_TXT_records""
| setfields detection_description = """"
| setfields severity = ""medium"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2006968 Proofpoint TAP Clicked to Zscaler allowed - Rule",hel6342,"send_to_sentinel",search,"19 * * * *","-30d",now,"index=zscaler earliest=-30d latest=now [ search index=proofpoint sourcetype = proofpoint_tap_siem eventType=clicks* threatStatus != falsePositive earliest=-1h latest=now
    | rex field=url ""^(https?://)?(?P<domain>[^\/]+)""
    | fields domain | dedup domain | rename domain AS ehost ]
| stats count AS request_count by _time, action, ehost, eurl, user, Agent
| rename ehost AS dns
| eval zscaler_url = eurl
| eval z_compare_url=substr(eurl, 1, 150)
| join dns [ search index=proofpoint sourcetype = proofpoint_tap_siem eventType=clicks* threatStatus!=falsePositive earliest=-1h latest=now
        | eval proofpoint_url = url
        | rex field=url ""^(https?://)?(?P<dns>[^\/]+)"" 
        | rex field=url ""^(https?://)?(?P<p_compare_url>.+)"" | eval p_compare_url=urldecode(p_compare_url) | eval p_compare_url=substr(p_compare_url, 1, 150)
        | table classification, clickIP, clickTime, eventTime, eventType, sender, recipient, threatStatus, dns, p_compare_url, proofpoint_url]
        | eval clickTime=strptime(clickTime, ""%Y-%m-%dT%T.%Q%Z""), eventTime=strptime(eventTime, ""%Y-%m-%dT%T.%Q%Z"")
        | where p_compare_url == z_compare_url OR (NOT match(z_compare_url, ""/"") AND (_time >= (clickTime - 60*15)) AND (_time <= (clickTime + 60*15)))
        | eval clickTime=strftime(clickTime,""%Y-%m-%dT %H:%M:%S.%Q""), eventTime=strftime(eventTime,""%Y-%m-%dT %H:%M:%S.%Q"")
| table _time, action, dns, user, Agent, request_count, clickIP, clickTime, eventTime, eventType, proofpoint_url, zscaler_url
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2006968 Proofpoint TAP Clicked to Zscaler allowed""
| setfields detection_description = ""Identifies outbound proxy activity (Zscaler) that appear to correlate with Proofpoint TAP clisksPermitted or clicksBlocked events.""
| setfields severity = """" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2012408 Specific Powershell Bypass and Encoding Syntax - Rule",sgb2991,"send_to_sentinel",search,"50 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*-nop -exec bypass -EncodedCommand*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2012408 Specific Powershell Bypass and Encoding Syntax""
| setfields detection_description = ""DET-2012408 Specific Powershell Bypass and Encoding Syntax""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1059.001']""
``` END ```"
"Threat - DET-2055986 Powercat Usage Detection #1 - Rule",sgb2991,"send_to_sentinel",search,"24 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""cmd.exe"" OR process_name=""powershell.exe"" OR process_name=""PowerShell_ISE.exe"") AND cmdline=""*powercat*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2055986 Powercat Usage Detection #1""
| setfields detection_description = ""DET-2055986 Powercat Usage Detection #1""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2055986 Powercat Usage Detection #2 - Rule",sgb2991,"send_to_sentinel",search,"24 * * * *","-1h",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") Message=""*powercat*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2055986 Powercat Usage Detection #2""
| setfields detection_description = ""DET-2055986 Powercat Usage Detection #2""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2322216 Conti net stop commands - Rule",sgb2991,"send_to_sentinel",search,"45 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=net.exe cmdline IN ('net stop ""Sophos MCS Client"" /y', 'net stop VeeamEnterpriseManagerSvc /y', 'net stop SQLAgent$SOPHOS /y', 'net stop FA_Scheduler /y', 'net stop McShield /y', 'net stop MSOLAP$TPS /y', 'net stop AVP /y', 'net stop SQLAgent$TPS /y', 'net stop mfemms /y', 'net stop WRSVC /y', 'net stop Smcinst /y', 'net stop MSSQLFDLauncher$SYSTEM_BGC /y', 'net stop SQLSafeOLRService /y', 'net stop mozyprobackup /y', 'net stop Antivirus /y', 'net stop DCAgent /y', 'net stop ""Sophos Device Control Service"" /y', 'net stop BackupExecManagementService /y', 'net stop MSSQLFDLauncher$SHAREPOINT /y', 'net stop swi_update_64 /y', 'net stop MsDtsServer110 /y', 'net stop ekrn /y', 'net stop EsgShKernel /y', 'net stop SamSs /y', 'net stop MSExchangeMTA /y', 'net stop MBEndpointAgent /y', 'net stop IISAdmin /y', 'net stop BackupExecRPCService /y', 'net stop MSSQLServerOLAPService /y', 'net stop TrueKeyServiceHelper /y', 'net stop MSSQLServerADHelper /y', 'net stop MSSQLServerADHelper100 /y', 'net stop SQLAgent$PROFXENGAGEMENT /y', 'net stop MSSQL$SQL_2008 /y', 'net stop BackupExecAgentBrowser /y', 'net stop ""Sophos AutoUpdate Service"" /y', 'net stop swi_update /y', 'net stop AcrSch2Svc /y', 'net stop SQLAgent$CXDB /y', 'net stop OracleClientCache80 /y', 'net stop MSSQL$SOPHOS /y', 'net stop SQLAgent$PROD /y', 'net stop VeeamTransportSvc /y', 'net stop VeeamHvIntegrationSvc /y', 'net stop TrueKey /y', 'net stop ""Sophos Web Control Service"" /y', 'net stop MSSQLFDLauncher /y', 'net stop KAVFS /y', 'net stop ""SQLsafe Backup Service"" /y', 'net stop MSExchangeIS /y', 'net stop MsDtsServer /y', 'net stop MSSQLFDLauncher$SQL_2008 /y', 'net stop McAfeeEngineService /y', 'net stop SQLTELEMETRY /y', 'net stop MSSQL$BKUPEXEC /y', 'net stop ""Sophos Message Router"" /y', 'net stop MsDtsServer100 /y', 'net stop VeeamDeploySvc /y', 'net stop AcronisAgent /y', 'net stop ""Symantec System Recovery"" /y', 'net stop MSSQL$SQLEXPRESS /y', 'net stop MSExchangeSA /y', 'net stop SQLAgent$VEEAMSQL2008R2 /y', 'net stop MSSQL$TPSAMA /y', 'net stop ""Sophos Safestore Service"" /y', 'net stop SstpSvc /y', 'net stop McTaskManager /y', 'net stop SmcService /y', 'net stop McAfeeFrameworkMcAfeeFramework /y', 'net stop EraserSvc11710 /y', 'net stop W3Svc /y', 'net stop SQLAgent$SYSTEM_BGC /y', 'net stop MSSQL$VEEAMSQL2008R2 /y', 'net stop BackupExecDeviceMediaService /y', 'net stop ReportServer$SYSTEM_BGC /y', 'net stop ""Enterprise Client Service"" /y', 'net stop SQLAgent$SBSMONITORING /y', 'net stop MSSQLFDLauncher$SBSMONITORING /y', 'net stop TrueKeyScheduler /y', 'net stop wbengine /y', 'net stop masvc /y', 'net stop BackupExecJobEngine /y', 'net stop ""SQL Backups"" /y', 'net stop MSExchangeSRS /y', 'net stop SQLAgent$PRACTTICEMGT /y', 'net stop MSOLAP$SQL_2008 /y', 'net stop ESHASRV /y', 'net stop MSExchangeMGMT /y', 'net stop SQLAgent$TPSAMA /y', 'net stop klnagent /y', 'net stop IMAP4Svc /y', 'net stop sacsvr /y', 'net stop SQLSERVERAGENT /y', 'net stop ""Sophos File Scanner Service"" /y', 'net stop MSSQL$PROFXENGAGEMENT /y', 'net stop mfevtp /y', 'net stop ARSM /y', 'net stop ReportServer$SQL_2008 /y', 'net stop McAfeeFramework /y', 'net stop MSSQLFDLauncher$PROFXENGAGEMENT /y', 'net stop KAVFSGT /y', 'net stop BackupExecAgentAccelerator /y', 'net stop SntpService /y', 'net stop VeeamCloudSvc /y', 'net stop swi_filter /y', 'net stop SQLAgent$CITRIX_METAFRAME /y', 'net stop kavfsslp /y', 'net stop SQLBrowser /y', 'net stop RESvc /y', 'net stop tmlisten /y', 'net stop MSSQL$VEEAMSQL2008R2 /y', 'net stop VeeamDeploymentService /y', 'net stop MSSQLFDLauncher$TPS /y', 'net stop ""Sophos Clean Service"" /y', 'net stop macmnsvc /y', 'net stop wbengine /y', 'net stop MySQL57 /y', 'net stop ""Zoolz 2 Service"" /y', 'net stop SQLAgent$SQLEXPRESS /y', 'net stop msftesql$PROD /y', 'net stop UI0Detect /y', 'net stop SQLAgent$SQL_2008 /y', 'net stop POP3Svc /y', 'net stop SMTPSvc /y', 'net stop MSExchangeES /y', 'net stop SQLAgent$PRACTTICEBGC /y', 'net stop ""Sophos MCS Agent"" /y', 'net stop SQLAgent$ECWDB2 /y', 'net stop MSSQL$PRACTICEMGT /y', 'net stop MSSQL$PRACTTICEBGC /y', 'net stop MSSQL$VEEAMSQL2012 /y', 'net stop MSSQL$ECWDB2 /y', 'net stop VeeamRESTSvc /y', 'net stop SAVService /y', 'net stop ""Acronis VSS Provider"" /y', 'net stop SAVAdminService /y', 'net stop SDRSVC /y', 'net stop VeeamNFSSvc /y', 'net stop EhttpSrv /y', 'net stop ShMonitor /y', 'net stop ReportServer$TPSAMA /y', 'net stop MSSQL$TPS /y', 'net stop SNAC /y', 'net stop ReportServer /y', 'net stop MSOLAP$SYSTEM_BGC /y', 'net stop MSSQL$PROD /y', 'net stop VeeamMountSvc /y', 'net stop bedbg /y', 'net stop MSSQLFDLauncher$TPSAMA /y', 'net stop MBAMService /y', 'net stop ntrtscan /y', 'net stop ReportServer$TPS /y', 'net stop sophossps /y', 'net stop svcGenericHost /y', 'net stop ""SQLsafe Filter Service"" /y', 'net stop MSOLAP$TPSAMA /y', 'net stop EPSecurityService /y', 'net stop VeeamBackupSvc /y', 'net stop ""Sophos System Protection Service"" /y', 'net stop SQLAgent$VEEAMSQL2012 /y', 'net stop VeeamCatalogSvc /y', 'net stop VeeamBrokerSvc /y', 'net stop SQLTELEMETRY$ECWDB2 /y', 'net stop MSSQL$SBSMONITORING /y', 'net stop MSSQL$SYSTEM_BGC /y', 'net stop SQLAgent$BKUPEXEC /y', 'net stop MMS /y', 'net stop ""Veeam Backup Catalog Data Service"" /y', 'net stop SQLWriter /y', 'net stop BackupExecVSSProvider /y', 'net stop ""Sophos Agent"" /y', 'net stop swi_service /y', 'net stop ""Sophos Health Service"" /y', 'net stop MSSQLSERVER /y', 'net stop SQLAgent$SHAREPOINT /y', 'net stop SQLAgent$VEEAMSQL2008R2 /y', 'net stop TmCCSF /y', 'net stop SepMasterService /y', 'net stop MSSQL$SHAREPOINT /y', 'net stop NetMsmqActivator /y', 'net stop EPUpdateService /y', 'net stop PDVFSService /y')
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2322216 Conti net stop commands""
| setfields detection_description = ""DET-2322216 Conti net stop commands""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1489']""
``` END ```"
"Threat - DET-2322226 BloodHound/SharpHound usage - Rule",sgb2991,"send_to_sentinel",search,"45 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name IN ('sharphound.exe', 'bloodhound.exe')) OR (cmdline IN (""* -CollectionMethod All *"", ""*.exe -c All -d *"", ""*Invoke-Bloodhound*"", ""*Get-BloodHoundData*"")) OR (cmdline=""* -JsonFolder *"" AND cmdline=""* -ZipFileName *"") OR (cmdline=""* DCOnly *"" AND cmdline=""* --NoSaveCache *"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2322226 BloodHound/SharpHound usage""
| setfields detection_description = ""DET-2322226 BloodHound/SharpHound usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2322369 Conti batch file usage - Rule",sgb2991,"send_to_sentinel",search,"50 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=cmd.exe AND (cmdline=* adft.bat OR cmdline=* cp.bat)
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2322369 Conti batch file usage""
| setfields detection_description = ""DET-2322369 Conti batch file usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2329094 Conti ping/portscan usage - Rule",sgb2991,"send_to_sentinel",search,"55 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=portscan.exe OR (process_name=ping.exe AND cmdline=""*.local -n 1"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2329094 Conti ping/portscan usage""
| setfields detection_description = ""DET-2329094 Conti ping/portscan usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2329104 Conti WMIC usage - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=wmic.exe cmdline=""*node*"" AND cmdline IN (""*process call create*"", ""*sys.dll entryPoint*"",  ""*doc.dll entryPoint*"", ""*sys64.dll entryPoint*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2329104 Conti WMIC usage""
| setfields detection_description = ""DET-2329104 Conti WMIC usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2329348 Conti copy usage - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=cmd.exe cmdline=""*copy*"" AND cmdline=""*.dll*"" AND (cmdline=""*c$*"" OR cmdline=""*d$*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2329348 Conti copy usage""
| setfields detection_description = ""DET-2329348 Conti copy usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2330255 Conti web traffic artifacts - Firewall Query - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"index=firewall Cisco_ASA_action=accessed url!=""*buckslou.com*"" url!=""*delaneyspubsc.com"" AND (url=*/us/ky/louisville/312-s-fourth-st.html OR url=""*Menus.aspx"" OR url=""*/OrderEntryService.asmx/AddOrderLine"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2330255 Conti web traffic artifacts - Firewall Query""
| setfields detection_description = ""DET-2330255 Conti web traffic artifacts - Firewall Query""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2330255 Conti web traffic artifacts - Zscaler Query - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"index=zscaler ua=""Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko)"" erefererhost!=""firehouse.alohaorderonline.com"" erefererhost!=""jeffrubys.alohaorderonline.com"" erefererhost!=""peterpiperpizza.alohaorderonline.com"" erefererhost!=""www.firehousesubs.com"" erefererhost!=""www.beefobradys.com"" erefererhost!=""www.peterpiperpizza.com"" OR referer=*/us/ky/louisville/312-s-fourth-st.html OR url=""*Menus.aspx"" OR url=""*/OrderEntryService.asmx/AddOrderLine""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2330255 Conti web traffic artifacts - Zscaler Query""
| setfields detection_description = ""DET-2330255 Conti web traffic artifacts - Zscaler Query""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2344820 Rclone usage - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=rclone.exe
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2344820 Rclone usage""
| setfields detection_description = ""DET-2344820 Rclone usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2347882 WMIC remote process get enumeration - Rule",sgb2991,"send_to_sentinel",search,"15 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=wmic.exe AND (cmdline=""*node*"" AND cmdline=""*process get*"" AND cmdline=""*CSName,Description,ExecutablePath,ProcessID*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2347882 WMIC remote process get enumeration""
| setfields detection_description = ""DET-2347882 WMIC remote process get enumeration""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2355796 WMIC root subscription namespace actions - Rule",sgb2991,"send_to_sentinel",search,"10 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=wmic.exe AND (cmdline=""*root*"" AND cmdline=""*subscription*"" AND cmdline=""*create*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2355796 WMIC root subscription namespace actions""
| setfields detection_description = ""DET-2355796 WMIC root subscription namespace actions""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2355976 Conti - HelloKitty run as outlook.exe - Rule",sgb2991,"send_to_sentinel",search,"10 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=outlook.exe cmdline=""* -key *""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2355976 Conti - HelloKitty run as outlook.exe""
| setfields detection_description = ""DET-2355976 Conti - HelloKitty run as outlook.exe""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2355983 Conti actor utility executables - Rule",sgb2991,"send_to_sentinel",search,"15 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name IN (""grabff.exe"", ""filegrabber.exe"", ""XenAllPasswordPro.exe"", ""veeamp.exe"", ""secretsdump.exe"")) OR cmdline=""* -just-dc *""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2355983 Conti actor utility executables""
| setfields detection_description = ""DET-2355983 Conti actor utility executables""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2356338 Potential sticky key elevation - Rule",sgb2991,"send_to_sentinel",search,"15 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name IN (""icacls.exe"", ""takeown.exe"", ""copy.exe"") cmdline=""*sethc.exe*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2356338 Potential sticky key elevation""
| setfields detection_description = ""DET-2356338 Potential sticky key elevation""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2356349 Conti actor Terminal Services enable via cmd - Rule",sgb2991,"send_to_sentinel",search,"15 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=reg.exe (cmdline=""*Terminal Server*"" AND cmdline=""* add *"" AND cmdline=""*DenyTSConnections*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2356349 Conti actor Terminal Services enable via cmd""
| setfields detection_description = ""DET-2356349 Conti actor Terminal Services enable via cmd""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2356364 Add WinFW rule for remote desktop - Rule",sgb2991,"send_to_sentinel",search,"10 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=netsh.exe AND (cmdline=""*firewall*"" AND cmdline=""*remote desktop*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2356364 Add WinFW rule for remote desktop""
| setfields detection_description = ""DET-2356364 Add WinFW rule for remote desktop""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2357166 Abnormal PSExec realtime usage - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=psexec.exe cmdline=""* -realtime*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2357166 Abnormal PSExec realtime usage""
| setfields detection_description = ""DET-2357166 Abnormal PSExec realtime usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2357175 DomainPasswordSpray powershell usage - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"(index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") cmdline=""*Invoke-DomainPasswordSpray*"") OR (index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"") Message=""*Invoke-DomainPasswordSpray*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2357175 DomainPasswordSpray powershell usage""
| setfields detection_description = ""DET-2357175 DomainPasswordSpray powershell usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2357189 ff files created from filegrabber - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=11 file_name=CASE(ff_*) file_path=""*public*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2357189 ff files created from filegrabber""
| setfields detection_description = ""DET-2357189 ff files created from filegrabber""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2357194 Rclone binary and/or config file creation - Rule",sgb2991,"send_to_sentinel",search,"30 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=11 file_name IN (""rclone.exe"", ""rclone.conf"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2357194 Rclone binary and/or config file creation""
| setfields detection_description = ""DET-2357194 Rclone binary and/or config file creation""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2375387 Revoke hashicorp root token - Rule",sgb2991,"send_to_sentinel",search,"0 * * * *","-1h",now,"index=hashicorp request.path=""auth/token/revoke*"" AND request.path!=""auth/token/revoke-self""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2375387 Revoke hashicorp root token""
| setfields detection_description = ""DET-2375387 Revoke hashicorp root token""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2383658-Domain_Controller-Abnormal_Port_Utilization - Rule",axg3394,"send_to_sentinel",search,"1 * * * *","-1h",now,"index=paloalto (host=east* OR host=central*) src_ip IN(""10.75.3.132"" ""10.75.3.133"" ""10.73.3.141"" ""10.73.3.139"") action=allowed sourcetype=""pan:traffic"" log_subtype=end src_zone=inside dest_zone=internet NOT dest_port IN(80 443 53)
| table _time src_ip dest_ip transport dest_port duration bytes bytes_in bytes_out
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2383658-Domain_Controller-Abnormal_Port_Utilization""
| setfields detection_description = ""DET-2383658-Domain_Controller-Abnormal_Port_Utilization""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2462995 Spoolsv Spawning Rundll32 - Rule",hel6342,"send_to_sentinel",search,"52 * * * *","-1h",now,"sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational EventID=1  parent_process_name=spoolsv.exe process_name=rundll32.exe
    | stats count min(_time) as firstTime max(_time) as lastTime by Computer, User, parent_process_name, process_name, OriginalFileName, process_path, CommandLine
    |  search NOT CommandLine IN ("",StatusMonitorEntryPoint"", ""*,CnmDxPEntryPoint*"", ""*SNAGITPT64.DLL\"",LaunchSnagItExt*"", ""*PRINTUI.DLL,PrintUIEntry*"", ""*\\cnmsmbl.dll,*"", ""*C:\\WINDOWS\\system32\\spool\\DRIVERS\\x64\\3\\CNM*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2462995 Spoolsv Spawning Rundll32""
| setfields detection_description = ""Ref: https://www.splunk.com/en_us/blog/security/i-pity-the-spool-detecting-printnightmare-cve-2021-34527.html""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2524924-Unauthorized_usage_of_Avast_VPN - Rule",axg3394,"send_to_sentinel",search,"36 * * * *","-1h",now,"index=zscaler login!=HUM_Guest ua IN(""VPN Update Agent"") ehost IN(""*.avcdn.net"" ""*.avast.com"")
| stats count by _time cip login sip ehost eurlpath ua
| sort 0 + _time
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2524924-Unauthorized_usage_of_Avast_VPN""
| setfields detection_description = ""DET-2524924-Unauthorized_usage_of_Avast_VPN""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2535878 Bazarcall Maldoc Command Syntax - Rule",sgb2991,"send_to_sentinel",search,"40 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*-urlcache -f -split*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2535878 Bazarcall Maldoc Command Syntax""
| setfields detection_description = ""DET-2535878 Bazarcall Maldoc Command Syntax""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2647084-Possible_UNC2529_Activity - Rule",axg3394,"send_to_sentinel",search,"39 * * * *","-1h",now,"index=zscaler sip IN(104.193.252.0/22 162.244.32.0/22 162.248.224.0/22 185.130.104.0/22 185.159.80.0/22 185.162.128.0/22 185.180.196.0/22 185.209.160.0/22 185.223.93.0/24 185.223.94.0/23 193.0.201.0/24 204.155.28.0/22 45.159.188.0/23 45.159.190.0/24 91.239.227.0/24)
| rex field=ehost ""(?<multiplesubdomain>[A-z0-9\-]+\.[A-z0-9\-]+\.[A-z0-9\-]+\.[A-z]+)$""
| search multiplesubdomain=*
| search NOT eurlpath IN(""*.css"" ""*.jpg"" ""*.svg"" ""*.js"" ""*.png"" ""/assets/vendor/ionicons/fonts/ionicons.ttf?v=2.0.0"")
| stats count by sip ehost eurlpath cip login
| sort 0 - count
| stats sum(count) as domainCount list(cip) as cip list(login) as login list(count) as pathCount list(eurlpath) as eurlpath by ehost
| sort 0 - domainCount
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2647084-Possible_UNC2529_Activity""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_wiki/wikis/Detections/8460/DET-2647084-Possible_UNC2529_Activity""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2675924 win_susp_control_cve_2021_40444 - Rule",sgb2991,"send_to_sentinel",search,"40 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=control.exe AND (parent_process_name = ""winword.exe"" OR parent_process_name = ""excel.exe"" OR parent_process_name = ""powerpnt.exe"" OR parent_process_name = ""msaccess.exe"" OR parent_process_name = ""mspub.exe"")   cmdline!=""\""C:\\WINDOWS\\system32\\control.exe\"" input.dll""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2675924 win_susp_control_cve_2021_40444""
| setfields detection_description = ""DET-2675924 win_susp_control_cve_2021_40444""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2676406 Susp_Remote_URL_CAB_or_HTML_Download - Rule",sgb2991,"send_to_sentinel",search,"40 * * * *","-1h",now,"index=zscaler eurlpath IN(""*.html"" ""*.cab"") NOT (ehost=""theleapfroggroup.salsalabs.org"" AND eurlpath=""/leapfrog2022gala/index.html"")
| regex eurlpath=""^\/[a-z0-9]{16}\/.+\.(html|cab)$""
| regex eurl=""^.*\.[a-z]{3}\/.*[0-9].*\/[A-z0-9]+\.(html|cab)$""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2676406 Susp_Remote_URL_CAB_or_HTML_Download""
| setfields detection_description = ""DET-2676406 Susp_Remote_URL_CAB_or_HTML_Download""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2677398 initial_access_suspicious_ms_office_child_process - Rule",sgb2991,"send_to_sentinel",search,"40 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""control.exe"" AND (cmdline = ""*.jpg*"" OR cmdline = ""*.png*"" OR cmdline = ""*.gif*"" OR cmdline = ""*.bmp*"" OR cmdline = ""*.jpeg*"" OR cmdline = ""*.TIFF*"" OR cmdline = ""*.inf*"" OR cmdline = ""*.dat*"" OR cmdline = ""*.cpl:*/*"" OR cmdline = ""*..*"" OR cmdline = ""*/AppData/Local/*"" OR cmdline = ""*:\\Users\\Public\\*"" OR cmdline = ""*\\AppData\\Local\*"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2677398 initial_access_suspicious_ms_office_child_process""
| setfields detection_description = ""DET-2677398 initial_access_suspicious_ms_office_child_process""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2768397 Revil malicious file name - Rule",sgb2991,"send_to_sentinel",search,"55 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=11 file_name=""microsoft.security""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2768397 Revil malicious file name""
| setfields detection_description = ""DET-2768397 Revil malicious file name""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2768618 rundll32 update usage - Rule",sgb2991,"send_to_sentinel",search,"18 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""rundll32.exe"" cmdline=""*update /i*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2768618 rundll32 update usage""
| setfields detection_description = ""DET-2768618 rundll32 update usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2772826 Renamed rclone with parameters - Rule",sgb2991,"send_to_sentinel",search,"8 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 cmdline=""*--config *"" AND cmdline=""* --no-check-certificate *""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2772826 Renamed rclone with parameters""
| setfields detection_description = ""DET-2772826 Renamed rclone with parameters""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2786583 Revil bitsadmin usage - Rule",sgb2991,"send_to_sentinel",search,"10 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""bitsadmin.exe"" cmdline=""* /transfer *""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2786583 Revil bitsadmin usage""
| setfields detection_description = ""DET-2786583 Revil bitsadmin usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2786753 WMIC AV enumeration - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""wmic.exe"" cmdline=""*AntiVirusProduct*"" cmdline=""*localhost*"" cmdline=""*/Format*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2786753 WMIC AV enumeration""
| setfields detection_description = ""DET-2786753 WMIC AV enumeration""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2787049 IcedID scheduled task - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=12 registry_path=""HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\*"" registry_path=""*wewouwquge*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2787049 IcedID scheduled task""
| setfields detection_description = ""DET-2787049 IcedID scheduled task""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2787236 Revil runonce keys - Rule",sgb2991,"send_to_sentinel",search,"35 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") host=WKR90SZM1G (EventCode=12 OR EventCode=13 OR EventCode=14) registry_path=""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*AstraZeneca"" OR registry_path=""HKLM\\SOFTWARE\\WOW6432NODE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*AstraZeneca"" OR registry_path=""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*Ponyaz"" OR registry_path=""HKLM\\SOFTWARE\\WOW6432NODE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*Ponyaz"" OR registry_path=""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*MarineLePen"" OR registry_path=""HKLM\\SOFTWARE\\WOW6432NODE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*MarineLePen"" OR registry_path=""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*b2I0uo"" OR registry_path=""HKLM\\SOFTWARE\\WOW6432NODE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\*b2I0uo""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2787236 Revil runonce keys""
| setfields detection_description = ""DET-2787236 Revil runonce keys""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2792433 mimikatz via comsvcs usage - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""rundll32.exe"" cmdline=""*comsvcs.dll""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2792433 mimikatz via comsvcs usage""
| setfields detection_description = ""DET-2792433 mimikatz via comsvcs usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2793240 findstr password suspicious usage - Rule",sgb2991,"send_to_sentinel",search,"35 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""findstr.exe"" cmdline=""*password*"" cmdline!=""*RTServer*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2793240 findstr password suspicious usage""
| setfields detection_description = ""DET-2793240 findstr password suspicious usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2793393 BetterSafetyKatz usage - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""BetterSafetyKatz.exe""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2793393 BetterSafetyKatz usage""
| setfields detection_description = ""DET-2793393 BetterSafetyKatz usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2793397 netsh enable network discovery - Rule",sgb2991,"send_to_sentinel",search,"20 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""netsh.exe"" cmdline=""*Network Discovery*"" cmdline=""*enable=Yes*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2793397 netsh enable network discovery""
| setfields detection_description = ""DET-2793397 netsh enable network discovery""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2796582 Enable RDP using WMI and Powershell - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (sourcetype=""wineventlog:Microsoft-Windows-PowerShell/Operational"" OR source=""WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""WMI:WinEventLog:Microsoft-Windows-PowerShell/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-PowerShell/Operational"")	Message=""*Get-WmiObject*"" Message=""*TerminalServiceSetting*"" Message=""*Enable-NetFirewallRule*"" Message=""*Remote Desktop*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2796582 Enable RDP using WMI and Powershell""
| setfields detection_description = ""DET-2796582 Enable RDP using WMI and Powershell""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2800735 Suspicious service installation - Rule",sgb2991,"send_to_sentinel",search,"15 * * * *","-1h",now,"index=wineventlog EventCode=7045 Service_File_Name=""C:\\Users*"" OR Service_File_Name=""*\\temp\\*"" AND service_name!=""OracleRemExecServiceV2"" AND service_name!=""ccmsetup"" AND Service_File_Name!=""*.sys"" AND Service_File_Name!=""*.tmp""AND Service_File_Name!=""*\\swagentinstaller\\*"" AND service_name!=""DGCleaner_PostSvc"" AND service_name!=""SolarWinds Web Performance Monitor Remote Deployment Service"" AND service_name!=""SolarWinds Agent Installer"" AND service_name!=""OracleOraClient*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2800735 Suspicious service installation""
| setfields detection_description = ""DET-2800735 Suspicious service installation""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2804793 Certutil decode to exe - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (Description=""CertUtil.exe"" OR OriginalFileName=""CertUtil.exe"" OR process_name=""certutil.exe"") cmdline=""* -decode *"" cmdline=""*.exe""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2804793 Certutil decode to exe""
| setfields detection_description = ""DET-2804793 Certutil decode to exe""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2880345 DiskCryptor File Creation - Rule",sgb2991,"send_to_sentinel",search,"35 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=11 file_name=""$dcsys$"" OR file_name=""myLog.txt"" OR file_name=""myconf.txt"" OR file_name=""dcapi.dll"" OR file_name=""dcinst.exe"" OR file_name=""dccon.exe"" OR file_name=""dcrypt.sys""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2880345 DiskCryptor File Creation""
| setfields detection_description = ""DET-2880345 DiskCryptor File Creation""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2880793 DiskCryptor Service Installation - Rule",sgb2991,"send_to_sentinel",search,"10 * * * *","-1h",now,"index=wineventlog EventCode=7045 service_name=""myCryptoraphyService"" OR service_name=""myCryptographyService""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2880793 DiskCryptor Service Installation""
| setfields detection_description = ""DET-2880793 DiskCryptor Service Installation""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2884911 DSQuery subnet usage - Rule",sgb2991,"send_to_sentinel",search,"5 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""dsquery.exe"" cmdline=""* subnet *""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2884911 DSQuery subnet usage""
| setfields detection_description = ""DET-2884911 DSQuery subnet usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2887293 Common_LSASS_Dumping_Output_Filename - Rule",jxm3591,"send_to_sentinel",search,"1 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 CommandLine=""* lsass.dmp*"" OR  CommandLine=""* lsass_dump*"" OR CommandLine=""* lsassdump.dmp*""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2887293 Common_LSASS_Dumping_Output_Filename""
| setfields detection_description = ""DET-2887293 Common_LSASS_Dumping_Output_Filename""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2919052 net user add usage - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 (process_name=""net.exe"" OR process_name=""net1.exe"") AND ((cmdline=""* user *"" AND cmdline=""* /add*"" AND cmdline=""* /Y*"") OR (cmdline=""* localgroup *"" AND cmdline=""* /add*"" AND cmdline=""* administrators *""))
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2919052 net user add usage""
| setfields detection_description = ""DET-2919052 net user add usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-2949710-Possible_CVE-2021-44228-JNDI_Vuln_Denied_Outbound_Connection - Rule",axg3394,"send_to_sentinel",search,"11 * * * *","-60m@m",now,"index=firewall host=ldc-cv9itr3.humana.com acl IN(""ldr1_access"" ""ldr2_access"") dest_zone=""outside"" dest_ip!=205.145.64.0/18 dest_ip!=76.252.204.162 (NOT (src_ip=""133.10.6.4"" AND dest_ip IN(205.145.0.0/16 133.106.0.0/16))) dest_port IN(""1099"" ""389"" ""636"" ""683"" ""684"" ""111"" ""834"" ""427"" ""624"" ""1389"")
| stats count by host _time src_ip dest_ip dest_port transport
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-2949710-Possible_CVE-2021-44228-JNDI_Vuln_Denied_Outbound_Connection""
| setfields detection_description = ""Reference: https://dev.azure.com/humana/Threat-Management-Operations/_wiki/wikis/Detections/9217/""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = ""['T1190']""
``` END ```"
"Threat - DET-3028117 Suspected Kerberoasting Activity - Rule",hel6342,"send_to_sentinel",search,"35 * * * *","-1h",now,"index=wineventlog 
    EventCode=4769 TicketEncryptionType=0x17 TicketOptions IN (0x40810010, 0x40810000)  Status=0x0
    ``` Exclude SPNs for machine accounts, krbtgts, the domain, and SQL service functional accounts ```
    NOT ServiceName IN (""*$*"", ""*krbtgt*"", ""*.*"", ""*_SqlSvc"")
    ``` Exclude sourced machine accounts ```
    TargetUserName != ""*$@*""
    ``` Exclude local requests on the DC ```
    IpAddress != ""::1""
    ``` Exclude Known High Freq source accounts ```
    ``` More ideally, these would be only from specific devices ... ```
    NOT TargetUserName IN (""SQL_Agent_Service@HUMAD.COM"", ""solarwindsvman@HUMAD.COM"", ""SentryDBA@HUMAD.COM"", ""*_SqlAgt@HUMAD.COM"", ""SCCM_Service@HUMAD.COM"", ""VEDAdmin@HUMAD.COM"", ""tsm_backup@HUMAD.COM"")
| where NOT like(TargetUserName,""%"".ServiceName.""%"")
| stats  min(_time) as FirstEvent, max(_time) AS LastEvent, dc(ServiceName) AS ServiceNameCount, values(ServiceName) AS ServiceNameSet
    by Computer, TargetUserName, TargetDomainName, IpAddress, TicketOptions, TicketEncryptionType, Status
| where ServiceNameCount > 10
| eval FirstEvent = strftime(FirstEvent, ""%Y-%m-%dT %H:%M:%S.%Q"")	
| eval LastEvent = strftime(LastEvent, ""%Y-%m-%dT %H:%M:%S.%Q"")
| rex mode=sed field=IpAddress ""s/::ffff://g""
| lookup dnslookup clientip as IpAddress OUTPUTNEW clienthost as IpRdns
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3028117 Suspected Kerberoasting Activity""
| setfields detection_description = ""DET-3028117 Suspected Kerberoasting Activity""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-3074617 Suspicious ntdsutil usage - Rule",sgb2991,"send_to_sentinel",search,"25 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""ntdsutil.exe"" cmdline=""*create *""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3074617 Suspicious ntdsutil usage""
| setfields detection_description = ""DET-3074617 Suspicious ntdsutil usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-3079035 ntdsAudit usage - Rule",sgb2991,"send_to_sentinel",search,"26 * * * *","-1h",now,"index=wineventlog (source=""WinEventLog:Microsoft-Windows-Sysmon/Operational"" OR source=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"") EventCode=1 process_name=""ntdsaudit.exe""
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-3079035 ntdsAudit usage""
| setfields detection_description = ""DET-3079035 ntdsAudit usage""
| setfields severity = ""high"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
| setfields mitre_technique = """"
``` END ```"
"Threat - DET-TEST Another test detection - Rule",hel6342,"email, send_to_sentinel",search,"* * * * *","-1m",now,"| tstats count AS count min(_time) AS min_time max(_time) AS max_time
    where index=dns
    query{} = ""*.wutsec.sh""
    BY query{}, host_addr{}, src_ip
| eval max_time = strftime(max_time,""%Y-%m-%dT%H:%M:%S.%Q"") 
| eval min_time = strftime(min_time,""%Y-%m-%dT%H:%M:%S.%Q"")
    



``` START
All data below this comment are required for integration with Sentinel for incident creation 
to work properly.
```
| makejson output=result_data_temp        ``` package all results into a single field ```
| strcat result_data_temp "" "" result_data ``` hack to make json immutable ... ```
| fields result_data
| addinfo ``` Get the sid of this search to use as a 'unique' key and reference variable ```
``` FILL OUT DETECTION DETAILS ```
| setfields detection_name = ""DET-TEST Another test detection""
| setfields detection_description = ""Please ignore, testing""
| setfields severity = ""critical"" ``` Valid values: Informational, Low, Medium, High ```
| setfields mitre_tactic = """" ``` Valid values: https://docs.microsoft.com/en-us/rest/api/securityinsights/stable/incidents/list-of-entities#killchainintent ```
``` END ```"
